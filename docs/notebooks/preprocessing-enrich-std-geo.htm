
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enrich Using Standard Geographies &#8212; BA-Python-API-Examples 0.1.0-dev0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../genindex.htm" />
    <link rel="search" title="Search" href="../search.htm" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.htm">BA-Python-API-Examples</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=knu2xs&repo=business-analyst-python-api-examples&type=watch&count=False&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup.htm">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../capabilities.htm">Capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows.htm">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools.htm">Tools</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.htm">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.htm" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Enrich-Using-Standard-Geographies">
<h1>Enrich Using Standard Geographies<a class="headerlink" href="#Enrich-Using-Standard-Geographies" title="Permalink to this headline">¶</a></h1>
<p>Starting off, we import a few required Python resources. While there are quite a few in there, the import of note is <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">arcgis.geoenrichment</span> <span class="pre">import</span> <span class="pre">Country,</span> <span class="pre">get_countries</span></code>. We are going to use this object and method to discover and perform our analysis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">arcgis.features</span> <span class="kn">import</span> <span class="n">GeoAccessor</span>
<span class="kn">from</span> <span class="nn">arcgis.geoenrichment</span> <span class="kn">import</span> <span class="n">Country</span>
<span class="kn">from</span> <span class="nn">arcgis.gis</span> <span class="kn">import</span> <span class="n">GIS</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
</pre></div>
</div>
</div>
<p>Next, we need some test data to work with. Hence, here we are accessing two files with pickled exports from Spatially Enabled Pandas Data Frames. One is of postal codes (zip codes) in Portland, Oregon, and the other is for block groups in Portland.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># paths to input data</span>
<span class="n">dir_prj</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>
<span class="n">dir_data</span> <span class="o">=</span> <span class="n">dir_prj</span><span class="o">/</span><span class="s1">&#39;data&#39;</span>
<span class="n">dir_raw</span> <span class="o">=</span> <span class="n">dir_data</span><span class="o">/</span><span class="s1">&#39;raw&#39;</span>

<span class="c1"># import the two preprocessors from the examples</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dir_prj</span><span class="o">/</span><span class="s1">&#39;src&#39;</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">ba_samples.preprocessing</span> <span class="kn">import</span> <span class="n">EnrichStandardGeography</span><span class="p">,</span> <span class="n">KeepOnlyEnrichColumns</span>

<span class="c1"># specifically, the data being used for this example - pickled dataframes</span>
<span class="n">postal_codes_pth</span> <span class="o">=</span> <span class="n">dir_raw</span><span class="o">/</span><span class="s1">&#39;postal_codes.pkl&#39;</span>
<span class="n">block_groups_pth</span> <span class="o">=</span> <span class="n">dir_raw</span><span class="o">/</span><span class="s1">&#39;block_groups.pkl&#39;</span>
</pre></div>
</div>
</div>
<p>For the first example, we are going to get a list of standard geography codes to use from the postal code data, just a list of zip codes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">postal_code_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">postal_codes_pth</span><span class="p">)</span>
<span class="n">postal_code_lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">postal_code_df</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">postal_code_lst</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;83801&#39;, &#39;83803&#39;, &#39;83810&#39;, &#39;83814&#39;, &#39;83815&#39;, &#39;83833&#39;, &#39;83835&#39;, &#39;83842&#39;, &#39;83854&#39;, &#39;83858&#39;, &#39;83861&#39;, &#39;83869&#39;, &#39;83876&#39;]
</pre></div></div>
</div>
<p>For the latter, we are going to use the Data Frame directly, and tell the <code class="docutils literal notranslate"><span class="pre">enrich</span></code> function which column to look in when we invoke the function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">block_groups_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">block_groups_pth</span><span class="p">)</span>

<span class="n">block_groups_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">block_groups_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 66 entries, 0 to 65
Data columns (total 3 columns):
 #   Column   Non-Null Count  Dtype
---  ------   --------------  -----
 0   ID       66 non-null     object
 1   NAME     66 non-null     object
 2   IDField  66 non-null     object
dtypes: object(3)
memory usage: 1.7+ KB
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>NAME</th>
      <th>IDField</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>160550001001</td>
      <td>160550001.001</td>
      <td>17660</td>
    </tr>
    <tr>
      <th>1</th>
      <td>160550003011</td>
      <td>160550003.011</td>
      <td>17660</td>
    </tr>
    <tr>
      <th>2</th>
      <td>160550003012</td>
      <td>160550003.012</td>
      <td>17660</td>
    </tr>
    <tr>
      <th>3</th>
      <td>160550003021</td>
      <td>160550003.021</td>
      <td>17660</td>
    </tr>
    <tr>
      <th>4</th>
      <td>160550004011</td>
      <td>160550004.011</td>
      <td>17660</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Now, we are going to need a connection to ArcGIS Online to demonstrate the abiliy to use ArcGIS Online for geoenrichment. This is accomplished by instantiating a <code class="docutils literal notranslate"><span class="pre">GIS</span></code> object instance with valid credentials read from environment variables.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gis_local</span> <span class="o">=</span> <span class="n">GIS</span><span class="p">(</span><span class="s1">&#39;pro&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Standard-Geography-From-a-List">
<h2>Standard Geography From a List<a class="headerlink" href="#Standard-Geography-From-a-List" title="Permalink to this headline">¶</a></h2>
<p>To enrich, we start by creating a <code class="docutils literal notranslate"><span class="pre">Country</span></code> object instance. As part of the constructor, we need to tell the object what Business Analyst source to use in the <code class="docutils literal notranslate"><span class="pre">gis</span></code> parameter. In this case, we are telling the object to use ArcGIS Pro with Business Analyst and local data for the United States.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">usa_local</span> <span class="o">=</span> <span class="n">Country</span><span class="p">(</span><span class="s1">&#39;usa&#39;</span><span class="p">,</span> <span class="n">gis</span><span class="o">=</span><span class="n">gis_local</span><span class="p">)</span>

<span class="n">usa_local</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Country - United States 2021 (&#39;local&#39;)&gt;
</pre></div></div>
</div>
<p>Next, we need to get some enrich variables to use. We can discover what is available using the <code class="docutils literal notranslate"><span class="pre">enrich_variables</span></code> property of the country object to retrieve a Pandas Data Frame of variables available for the country. From these tens of thousands of variables, we can prune this down to a manageable subset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ev</span> <span class="o">=</span> <span class="n">usa_local</span><span class="o">.</span><span class="n">enrich_variables</span>
<span class="n">kv</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span>
    <span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">data_collection</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;cy&#39;</span><span class="p">))</span>
<span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">kv</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>alias</th>
      <th>data_collection</th>
      <th>enrich_name</th>
      <th>enrich_field_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TOTPOP_CY</td>
      <td>2021 Total Population</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.TOTPOP_CY</td>
      <td>KeyUSFacts_TOTPOP_CY</td>
    </tr>
    <tr>
      <th>1</th>
      <td>GQPOP_CY</td>
      <td>2021 Group Quarters Population</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.GQPOP_CY</td>
      <td>KeyUSFacts_GQPOP_CY</td>
    </tr>
    <tr>
      <th>2</th>
      <td>DIVINDX_CY</td>
      <td>2021 Diversity Index</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.DIVINDX_CY</td>
      <td>KeyUSFacts_DIVINDX_CY</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TOTHH_CY</td>
      <td>2021 Total Households</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.TOTHH_CY</td>
      <td>KeyUSFacts_TOTHH_CY</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AVGHHSZ_CY</td>
      <td>2021 Average Household Size</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.AVGHHSZ_CY</td>
      <td>KeyUSFacts_AVGHHSZ_CY</td>
    </tr>
    <tr>
      <th>5</th>
      <td>MEDHINC_CY</td>
      <td>2021 Median Household Income</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.MEDHINC_CY</td>
      <td>KeyUSFacts_MEDHINC_CY</td>
    </tr>
    <tr>
      <th>6</th>
      <td>AVGHINC_CY</td>
      <td>2021 Average Household Income</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.AVGHINC_CY</td>
      <td>KeyUSFacts_AVGHINC_CY</td>
    </tr>
    <tr>
      <th>7</th>
      <td>PCI_CY</td>
      <td>2021 Per Capita Income</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.PCI_CY</td>
      <td>KeyUSFacts_PCI_CY</td>
    </tr>
    <tr>
      <th>8</th>
      <td>TOTHU_CY</td>
      <td>2021 Total Housing Units</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.TOTHU_CY</td>
      <td>KeyUSFacts_TOTHU_CY</td>
    </tr>
    <tr>
      <th>9</th>
      <td>OWNER_CY</td>
      <td>2021 Owner Occupied HUs</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.OWNER_CY</td>
      <td>KeyUSFacts_OWNER_CY</td>
    </tr>
    <tr>
      <th>10</th>
      <td>RENTER_CY</td>
      <td>2021 Renter Occupied HUs</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.RENTER_CY</td>
      <td>KeyUSFacts_RENTER_CY</td>
    </tr>
    <tr>
      <th>11</th>
      <td>VACANT_CY</td>
      <td>2021 Vacant Housing Units</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.VACANT_CY</td>
      <td>KeyUSFacts_VACANT_CY</td>
    </tr>
    <tr>
      <th>12</th>
      <td>MEDVAL_CY</td>
      <td>2021 Median Home Value</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.MEDVAL_CY</td>
      <td>KeyUSFacts_MEDVAL_CY</td>
    </tr>
    <tr>
      <th>13</th>
      <td>AVGVAL_CY</td>
      <td>2021 Average Home Value</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.AVGVAL_CY</td>
      <td>KeyUSFacts_AVGVAL_CY</td>
    </tr>
    <tr>
      <th>14</th>
      <td>POPGRW10CY</td>
      <td>2010-2021 Growth Rate: Population</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.POPGRW10CY</td>
      <td>KeyUSFacts_POPGRW10CY</td>
    </tr>
    <tr>
      <th>15</th>
      <td>HHGRW10CY</td>
      <td>2010-2021 Growth Rate: Households</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.HHGRW10CY</td>
      <td>KeyUSFacts_HHGRW10CY</td>
    </tr>
    <tr>
      <th>16</th>
      <td>FAMGRW10CY</td>
      <td>2010-2021 Growth Rate: Families</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.FAMGRW10CY</td>
      <td>KeyUSFacts_FAMGRW10CY</td>
    </tr>
    <tr>
      <th>17</th>
      <td>DPOP_CY</td>
      <td>2021 Total Daytime Population</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.DPOP_CY</td>
      <td>KeyUSFacts_DPOP_CY</td>
    </tr>
    <tr>
      <th>18</th>
      <td>DPOPWRK_CY</td>
      <td>2021 Daytime Pop: Workers</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.DPOPWRK_CY</td>
      <td>KeyUSFacts_DPOPWRK_CY</td>
    </tr>
    <tr>
      <th>19</th>
      <td>DPOPRES_CY</td>
      <td>2021 Daytime Pop: Residents</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.DPOPRES_CY</td>
      <td>KeyUSFacts_DPOPRES_CY</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Finally, we are ready to enrich the postal codes using the resources above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">EnrichStandardGeography</span><span class="p">(</span><span class="n">usa_local</span><span class="p">,</span> <span class="n">enrich_variables</span><span class="o">=</span><span class="n">kv</span><span class="p">,</span> <span class="n">standard_geography_level</span><span class="o">=</span><span class="s1">&#39;zip5&#39;</span><span class="p">,</span> <span class="n">return_geometry</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">KeepOnlyEnrichColumns</span><span class="p">(</span><span class="n">usa_local</span><span class="p">,</span> <span class="n">id_column</span><span class="o">=</span><span class="s1">&#39;id_field&#39;</span><span class="p">,</span> <span class="n">keep_geometry</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">trn_df</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">postal_code_lst</span><span class="p">)</span>

<span class="n">trn_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">trn_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 13 entries, 83801 to 83876
Data columns (total 20 columns):
 #   Column                 Non-Null Count  Dtype
---  ------                 --------------  -----
 0   keyusfacts_totpop_cy   13 non-null     float64
 1   keyusfacts_gqpop_cy    13 non-null     float64
 2   keyusfacts_divindx_cy  13 non-null     float64
 3   keyusfacts_tothh_cy    13 non-null     float64
 4   keyusfacts_avghhsz_cy  13 non-null     float64
 5   keyusfacts_medhinc_cy  13 non-null     float64
 6   keyusfacts_avghinc_cy  13 non-null     float64
 7   keyusfacts_pci_cy      13 non-null     float64
 8   keyusfacts_tothu_cy    13 non-null     float64
 9   keyusfacts_owner_cy    13 non-null     float64
 10  keyusfacts_renter_cy   13 non-null     float64
 11  keyusfacts_vacant_cy   13 non-null     float64
 12  keyusfacts_medval_cy   13 non-null     float64
 13  keyusfacts_avgval_cy   13 non-null     float64
 14  keyusfacts_popgrw10cy  13 non-null     float64
 15  keyusfacts_hhgrw10cy   13 non-null     float64
 16  keyusfacts_famgrw10cy  13 non-null     float64
 17  keyusfacts_dpop_cy     13 non-null     float64
 18  keyusfacts_dpopwrk_cy  13 non-null     float64
 19  keyusfacts_dpopres_cy  13 non-null     float64
dtypes: float64(20)
memory usage: 2.1+ KB
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>keyusfacts_totpop_cy</th>
      <th>keyusfacts_gqpop_cy</th>
      <th>keyusfacts_divindx_cy</th>
      <th>keyusfacts_tothh_cy</th>
      <th>keyusfacts_avghhsz_cy</th>
      <th>keyusfacts_medhinc_cy</th>
      <th>keyusfacts_avghinc_cy</th>
      <th>keyusfacts_pci_cy</th>
      <th>keyusfacts_tothu_cy</th>
      <th>keyusfacts_owner_cy</th>
      <th>keyusfacts_renter_cy</th>
      <th>keyusfacts_vacant_cy</th>
      <th>keyusfacts_medval_cy</th>
      <th>keyusfacts_avgval_cy</th>
      <th>keyusfacts_popgrw10cy</th>
      <th>keyusfacts_hhgrw10cy</th>
      <th>keyusfacts_famgrw10cy</th>
      <th>keyusfacts_dpop_cy</th>
      <th>keyusfacts_dpopwrk_cy</th>
      <th>keyusfacts_dpopres_cy</th>
    </tr>
    <tr>
      <th>id_field</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>83801</th>
      <td>8497.0</td>
      <td>0.0</td>
      <td>13.6</td>
      <td>3142.0</td>
      <td>2.70</td>
      <td>62413.0</td>
      <td>78746.0</td>
      <td>30156.0</td>
      <td>3563.0</td>
      <td>2660.0</td>
      <td>482.0</td>
      <td>421.0</td>
      <td>382542.0</td>
      <td>391184.0</td>
      <td>2.07</td>
      <td>2.09</td>
      <td>1.92</td>
      <td>6502.0</td>
      <td>1962.0</td>
      <td>4540.0</td>
    </tr>
    <tr>
      <th>83803</th>
      <td>656.0</td>
      <td>0.0</td>
      <td>10.5</td>
      <td>341.0</td>
      <td>1.92</td>
      <td>43344.0</td>
      <td>61732.0</td>
      <td>29472.0</td>
      <td>659.0</td>
      <td>264.0</td>
      <td>76.0</td>
      <td>318.0</td>
      <td>391333.0</td>
      <td>403113.0</td>
      <td>1.76</td>
      <td>1.80</td>
      <td>1.56</td>
      <td>499.0</td>
      <td>145.0</td>
      <td>354.0</td>
    </tr>
    <tr>
      <th>83810</th>
      <td>1090.0</td>
      <td>4.0</td>
      <td>11.7</td>
      <td>479.0</td>
      <td>2.27</td>
      <td>60088.0</td>
      <td>89006.0</td>
      <td>38340.0</td>
      <td>579.0</td>
      <td>406.0</td>
      <td>72.0</td>
      <td>100.0</td>
      <td>437903.0</td>
      <td>464383.0</td>
      <td>0.94</td>
      <td>0.96</td>
      <td>0.76</td>
      <td>762.0</td>
      <td>246.0</td>
      <td>516.0</td>
    </tr>
    <tr>
      <th>83814</th>
      <td>28546.0</td>
      <td>609.0</td>
      <td>21.2</td>
      <td>12454.0</td>
      <td>2.24</td>
      <td>57487.0</td>
      <td>80524.0</td>
      <td>34960.0</td>
      <td>15054.0</td>
      <td>6855.0</td>
      <td>5599.0</td>
      <td>2600.0</td>
      <td>377722.0</td>
      <td>508589.0</td>
      <td>1.86</td>
      <td>1.91</td>
      <td>1.72</td>
      <td>38178.0</td>
      <td>23011.0</td>
      <td>15167.0</td>
    </tr>
    <tr>
      <th>83815</th>
      <td>38614.0</td>
      <td>617.0</td>
      <td>24.1</td>
      <td>15247.0</td>
      <td>2.49</td>
      <td>56872.0</td>
      <td>73431.0</td>
      <td>29323.0</td>
      <td>16393.0</td>
      <td>9649.0</td>
      <td>5598.0</td>
      <td>1146.0</td>
      <td>308198.0</td>
      <td>374194.0</td>
      <td>1.79</td>
      <td>1.78</td>
      <td>1.51</td>
      <td>37345.0</td>
      <td>15891.0</td>
      <td>21454.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PowerTransformer</span> <span class="k">as</span> <span class="n">_PowerTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">TransformerMixin</span>

<span class="k">class</span> <span class="nc">PowerTransformer</span><span class="p">(</span><span class="n">_PowerTransformer</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>

        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">in_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">transform_function</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;box-cox&quot;</span><span class="p">:</span> <span class="n">boxcox</span><span class="p">,</span>
            <span class="s2">&quot;yeo-johnson&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yeo_johnson_transform</span><span class="p">,</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lmbda</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambdas_</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>  <span class="c1"># hide NaN warnings</span>
                <span class="n">X</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">transform_function</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">lmbda</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="n">X_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Xt_df</span>

<span class="n">ss</span> <span class="o">=</span> <span class="n">PowerTransformer</span><span class="p">()</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">trn_df</span><span class="p">)</span>

<span class="n">res</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">~\AppData\Local\Temp/ipykernel_11676/455125397.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">     25</span> ss <span class="ansi-yellow-intense-fg ansi-bold">=</span> PowerTransformer<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     26</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 27</span><span class="ansi-yellow-intense-fg ansi-bold"> </span>res <span class="ansi-yellow-intense-fg ansi-bold">=</span> ss<span class="ansi-yellow-intense-fg ansi-bold">.</span>transform<span class="ansi-yellow-intense-fg ansi-bold">(</span>trn_df<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     28</span>
<span class="ansi-green-fg">     29</span> res

<span class="ansi-green-intense-fg ansi-bold">~\AppData\Local\Temp/ipykernel_11676/455125397.py</span> in <span class="ansi-cyan-fg">transform</span><span class="ansi-blue-intense-fg ansi-bold">(self, X)</span>
<span class="ansi-green-fg">      5</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> transform<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> X<span class="ansi-yellow-intense-fg ansi-bold">:</span>pd<span class="ansi-yellow-intense-fg ansi-bold">.</span>DataFrame<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">      6</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 7</span><span class="ansi-yellow-intense-fg ansi-bold">         </span>check_is_fitted<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      8</span>         X <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_check_input<span class="ansi-yellow-intense-fg ansi-bold">(</span>X<span class="ansi-yellow-intense-fg ansi-bold">,</span> in_fit<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-green-intense-fg ansi-bold">False</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> check_positive<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-green-intense-fg ansi-bold">True</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> check_shape<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-green-intense-fg ansi-bold">True</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      9</span>

<span class="ansi-red-intense-fg ansi-bold">NameError</span>: name &#39;check_is_fitted&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PowerTransformer</span>

<span class="k">class</span> <span class="nc">PowerTransformerDF</span><span class="p">(</span><span class="n">PowerTransformer</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">)</span>

        <span class="c1"># call the parent transform</span>
        <span class="n">Xt_arr</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PowerTransformerDF</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># put the array back into a Pandas DataFrame</span>
        <span class="n">Xt_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Xt_arr</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;made it&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Xt_df</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pt</span> <span class="o">=</span> <span class="n">PowerTransformerDF</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;yeo-johnson&#39;</span><span class="p">,</span> <span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">trn_df</span><span class="p">)</span>

<span class="n">res</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
D:\Anaconda3\envs\geosaurus\lib\site-packages\sklearn\preprocessing\_data.py:3253: RuntimeWarning: divide by zero encountered in log
  loglike = -n_samples / 2 * np.log(x_trans.var())
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0.16855042, -1.11350457, -0.54217628,  0.11286603,  1.15896583,
         0.24090778, -0.18358702,  0.        , -0.04677022,  0.18431223,
        -0.06240979, -0.60302857,  0.06434243, -0.46008614,  0.50360584,
         0.50700755,  0.5253881 ,  0.07725866,  0.01926198,  0.13649968],
       [-1.19606641, -1.11350457, -1.47718988, -1.11876269, -1.77935893,
        -1.99284792, -1.68652843,  0.        , -1.06741558, -1.16113791,
        -0.96699852, -0.81475061,  0.17348101, -0.33543968, -0.08582943,
        -0.06192985, -0.18216615, -1.20874058, -1.22239441, -1.20442689],
       [-0.96889112, -0.14835307, -1.06063985, -0.95810529, -0.79336842,
        -0.07251376,  1.24661914,  0.        , -1.13045506, -0.95473799,
        -0.99126772, -1.43920363,  0.75550625,  0.26417162, -1.5413854 ,
        -1.59827938, -1.62841907, -1.02855037, -0.9930183 , -1.0430459 ],
       [ 1.04167961,  1.45241314,  0.63891596,  1.13405084, -0.89616209,
        -0.40967738,  0.03227582,  0.        ,  1.20157981,  0.93885596,
         1.3816789 ,  1.74768757,  0.00460604,  0.66062192,  0.10214702,
         0.15172907,  0.12831547,  1.29081606,  1.48052535,  1.01906476],
       [ 1.28752499,  1.4550447 ,  0.89981298,  1.30434606,  0.0852949 ,
        -0.48731748, -0.75686656,  0.        ,  1.28919827,  1.2477725 ,
         1.38156256,  0.43529789, -0.84833784, -0.64266844, -0.02965775,
        -0.10048841, -0.27783917,  1.27368264,  1.24055122,  1.31022225],
       [-0.75869165, -1.11350457, -1.1244652 , -0.70794344, -1.18246813,
         1.97274454,  1.40887954,  0.        , -0.37170729, -0.69953006,
        -0.73778795,  0.75380165,  2.30238152,  2.15765872,  1.71792246,
         1.7810859 ,  1.75087657, -0.64802936, -0.54585145, -0.69389795],
       [ 0.90736454,  1.07070124,  0.50968959,  0.90548763,  0.36673942,
         1.08936041,  1.22716918,  0.        ,  0.89461173,  0.99510966,
         0.76294388,  0.93229963, -0.04673038,  0.1479401 ,  0.12105982,
         0.09319424,  0.10872034,  0.89579674,  0.90410273,  0.91121055],
       [-1.78100868, -1.11350457, -1.32892609, -1.81165784, -0.57611362,
        -0.21319941,  0.91526347,  0.        , -1.88358275, -1.79725455,
        -1.86327952, -1.86965694,  0.76789664,  0.29260423, -0.63675688,
        -0.70489424, -0.52348584, -1.77330394, -1.7546355 , -1.78455596],
       [ 1.50300697,  1.0684284 ,  0.86749917,  1.46342671,  1.21656466,
        -0.30093019, -0.98086461,  0.        ,  1.50138896,  1.52872261,
         1.35681949,  1.00653741, -0.86460664, -0.51365565,  1.53447765,
         1.36191199,  1.36878954,  1.38143878,  1.26112063,  1.49468379],
       [ 0.65840462, -0.26494445,  0.29886151,  0.60804928,  1.21656466,
         1.16428484,  0.43407234,  0.        ,  0.54968561,  0.66846376,
         0.52374693,  0.45347846, -0.18485228, -0.08107399,  0.75653102,
         0.93004728,  0.99379798,  0.55673424,  0.45644338,  0.65367903],
       [ 0.03832337,  0.90446599,  0.24369469,  0.07976468, -0.68672141,
        -1.37857332, -1.51323234,  0.        , -0.03921687,  0.06583853,
         0.16457833, -0.27228891, -2.20987326, -2.24539451, -1.74017053,
        -1.68388975, -1.69559717,  0.12452364,  0.28236108,  0.02988145],
       [-0.14239615, -0.42286394,  0.07908875, -0.19128744,  0.88018746,
         0.27845388, -0.39927173,  0.        , -0.33065055, -0.15222551,
        -0.28875953, -0.59920057, -0.19512706, -0.45783549,  0.27310447,
         0.24972202,  0.305789  , -0.20395689, -0.36541249, -0.11050751],
       [-0.75780051, -0.66087372,  1.99583464, -0.82023454,  0.98987568,
         0.10930802,  0.2560712 ,  0.        , -0.56666606, -0.86418923,
        -0.66082709,  0.26902662,  0.28131358,  1.21315731, -0.9750483 ,
        -0.92521641, -0.8741696 , -0.73766963, -0.76305423, -0.7188073 ]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">trn_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(13, 20)
</pre></div></div>
</div>
</div>
<div class="section" id="Standard-Geography-From-a-Data-Frame">
<h2>Standard Geography From a Data Frame<a class="headerlink" href="#Standard-Geography-From-a-Data-Frame" title="Permalink to this headline">¶</a></h2>
<p>For the sake of efficiency, it is possible to provide the dataframe directly as input to the <code class="docutils literal notranslate"><span class="pre">enrich</span></code> method, and use the <code class="docutils literal notranslate"><span class="pre">standard_geography_id_column</span></code> parameter to specify the column. Also, in the following example, we are going to use a local source (ArcGIS Pro with Business Analyst and the USA data pack) and consolidate the steps above.</p>
<p>Previously, we loaded a dataframe from memory to use for enrichment consisting of all the block groups in Portland, OR. The values we will be using are located in the <code class="docutils literal notranslate"><span class="pre">ID</span></code> column.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">block_groups_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>NAME</th>
      <th>IDField</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>160550001001</td>
      <td>160550001.001</td>
      <td>17660</td>
    </tr>
    <tr>
      <th>1</th>
      <td>160550003011</td>
      <td>160550003.011</td>
      <td>17660</td>
    </tr>
    <tr>
      <th>2</th>
      <td>160550003012</td>
      <td>160550003.012</td>
      <td>17660</td>
    </tr>
    <tr>
      <th>3</th>
      <td>160550003021</td>
      <td>160550003.021</td>
      <td>17660</td>
    </tr>
    <tr>
      <th>4</th>
      <td>160550004011</td>
      <td>160550004.011</td>
      <td>17660</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Next, we create a <code class="docutils literal notranslate"><span class="pre">Country</span></code> object instance using the <code class="docutils literal notranslate"><span class="pre">'pro'</span></code> keyword to indicate using the local ArcGIS Pro instance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">usa_local</span> <span class="o">=</span> <span class="n">Country</span><span class="p">(</span><span class="s1">&#39;usa&#39;</span><span class="p">,</span> <span class="n">gis</span><span class="o">=</span><span class="n">GIS</span><span class="p">(</span><span class="s1">&#39;pro&#39;</span><span class="p">))</span>

<span class="n">usa_local</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Country - United States 2021 (&#39;local&#39;)&gt;
</pre></div></div>
</div>
<p>Just as before, we can filter to just the key current year variables. Although in this case they are identical, since there are small variations in available variables between local and ArcGIS Online, I always apply the filter on variables from the same soure as I will be using for enricment.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ev</span> <span class="o">=</span> <span class="n">usa_local</span><span class="o">.</span><span class="n">enrich_variables</span>
<span class="n">kv</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span>
    <span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">data_collection</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;cy&#39;</span><span class="p">))</span>
<span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">kv</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>alias</th>
      <th>data_collection</th>
      <th>enrich_name</th>
      <th>enrich_field_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TOTPOP_CY</td>
      <td>2021 Total Population</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.TOTPOP_CY</td>
      <td>KeyUSFacts_TOTPOP_CY</td>
    </tr>
    <tr>
      <th>1</th>
      <td>GQPOP_CY</td>
      <td>2021 Group Quarters Population</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.GQPOP_CY</td>
      <td>KeyUSFacts_GQPOP_CY</td>
    </tr>
    <tr>
      <th>2</th>
      <td>DIVINDX_CY</td>
      <td>2021 Diversity Index</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.DIVINDX_CY</td>
      <td>KeyUSFacts_DIVINDX_CY</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TOTHH_CY</td>
      <td>2021 Total Households</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.TOTHH_CY</td>
      <td>KeyUSFacts_TOTHH_CY</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AVGHHSZ_CY</td>
      <td>2021 Average Household Size</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.AVGHHSZ_CY</td>
      <td>KeyUSFacts_AVGHHSZ_CY</td>
    </tr>
    <tr>
      <th>5</th>
      <td>MEDHINC_CY</td>
      <td>2021 Median Household Income</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.MEDHINC_CY</td>
      <td>KeyUSFacts_MEDHINC_CY</td>
    </tr>
    <tr>
      <th>6</th>
      <td>AVGHINC_CY</td>
      <td>2021 Average Household Income</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.AVGHINC_CY</td>
      <td>KeyUSFacts_AVGHINC_CY</td>
    </tr>
    <tr>
      <th>7</th>
      <td>PCI_CY</td>
      <td>2021 Per Capita Income</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.PCI_CY</td>
      <td>KeyUSFacts_PCI_CY</td>
    </tr>
    <tr>
      <th>8</th>
      <td>TOTHU_CY</td>
      <td>2021 Total Housing Units</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.TOTHU_CY</td>
      <td>KeyUSFacts_TOTHU_CY</td>
    </tr>
    <tr>
      <th>9</th>
      <td>OWNER_CY</td>
      <td>2021 Owner Occupied HUs</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.OWNER_CY</td>
      <td>KeyUSFacts_OWNER_CY</td>
    </tr>
    <tr>
      <th>10</th>
      <td>RENTER_CY</td>
      <td>2021 Renter Occupied HUs</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.RENTER_CY</td>
      <td>KeyUSFacts_RENTER_CY</td>
    </tr>
    <tr>
      <th>11</th>
      <td>VACANT_CY</td>
      <td>2021 Vacant Housing Units</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.VACANT_CY</td>
      <td>KeyUSFacts_VACANT_CY</td>
    </tr>
    <tr>
      <th>12</th>
      <td>MEDVAL_CY</td>
      <td>2021 Median Home Value</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.MEDVAL_CY</td>
      <td>KeyUSFacts_MEDVAL_CY</td>
    </tr>
    <tr>
      <th>13</th>
      <td>AVGVAL_CY</td>
      <td>2021 Average Home Value</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.AVGVAL_CY</td>
      <td>KeyUSFacts_AVGVAL_CY</td>
    </tr>
    <tr>
      <th>14</th>
      <td>POPGRW10CY</td>
      <td>2010-2021 Growth Rate: Population</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.POPGRW10CY</td>
      <td>KeyUSFacts_POPGRW10CY</td>
    </tr>
    <tr>
      <th>15</th>
      <td>HHGRW10CY</td>
      <td>2010-2021 Growth Rate: Households</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.HHGRW10CY</td>
      <td>KeyUSFacts_HHGRW10CY</td>
    </tr>
    <tr>
      <th>16</th>
      <td>FAMGRW10CY</td>
      <td>2010-2021 Growth Rate: Families</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.FAMGRW10CY</td>
      <td>KeyUSFacts_FAMGRW10CY</td>
    </tr>
    <tr>
      <th>17</th>
      <td>DPOP_CY</td>
      <td>2021 Total Daytime Population</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.DPOP_CY</td>
      <td>KeyUSFacts_DPOP_CY</td>
    </tr>
    <tr>
      <th>18</th>
      <td>DPOPWRK_CY</td>
      <td>2021 Daytime Pop: Workers</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.DPOPWRK_CY</td>
      <td>KeyUSFacts_DPOPWRK_CY</td>
    </tr>
    <tr>
      <th>19</th>
      <td>DPOPRES_CY</td>
      <td>2021 Daytime Pop: Residents</td>
      <td>KeyUSFacts</td>
      <td>KeyUSFacts.DPOPRES_CY</td>
      <td>KeyUSFacts_DPOPRES_CY</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Just double checking, we can quickly see the correct value we need to use for United States Census Block Groups is <code class="docutils literal notranslate"><span class="pre">block_groups</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">usa_local</span><span class="o">.</span><span class="n">levels</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>level_name</th>
      <th>alias</th>
      <th>level_id</th>
      <th>id_field</th>
      <th>name_field</th>
      <th>singular_name</th>
      <th>plural_name</th>
      <th>admin_level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>block_groups</td>
      <td>Block Groups</td>
      <td>US.BlockGroups</td>
      <td>ID</td>
      <td>NAME</td>
      <td>Block Group</td>
      <td>Block Groups</td>
      <td>Admin11</td>
    </tr>
    <tr>
      <th>1</th>
      <td>tracts</td>
      <td>Census Tracts</td>
      <td>US.Tracts</td>
      <td>ID</td>
      <td>NAME</td>
      <td>Census Tract</td>
      <td>Census Tracts</td>
      <td>Admin10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>places</td>
      <td>Cities and Towns (Places)</td>
      <td>US.Places</td>
      <td>ID</td>
      <td>NAME</td>
      <td>Place</td>
      <td>Places</td>
      <td>Admin9</td>
    </tr>
    <tr>
      <th>3</th>
      <td>zip5</td>
      <td>ZIP Codes</td>
      <td>US.ZIP5</td>
      <td>ID</td>
      <td>NAME</td>
      <td>ZIP Code</td>
      <td>ZIP Codes</td>
      <td>Admin4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>csd</td>
      <td>County Subdivisions</td>
      <td>US.CSD</td>
      <td>ID</td>
      <td>NAME</td>
      <td>County Subdivision</td>
      <td>County Subdivisions</td>
      <td>Admin7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>counties</td>
      <td>Counties</td>
      <td>US.Counties</td>
      <td>ID</td>
      <td>NAME</td>
      <td>County</td>
      <td>Counties</td>
      <td>Admin3</td>
    </tr>
    <tr>
      <th>6</th>
      <td>cbsa</td>
      <td>CBSAs</td>
      <td>US.CBSA</td>
      <td>ID</td>
      <td>NAME</td>
      <td>CBSA</td>
      <td>CBSAs</td>
      <td>Admin5</td>
    </tr>
    <tr>
      <th>7</th>
      <td>cd</td>
      <td>Congressional Districts</td>
      <td>US.CD</td>
      <td>ID</td>
      <td>NAME</td>
      <td>Congressional District</td>
      <td>Congressional Districts</td>
      <td>Admin8</td>
    </tr>
    <tr>
      <th>8</th>
      <td>dma</td>
      <td>DMAs</td>
      <td>US.DMA</td>
      <td>ID</td>
      <td>NAME</td>
      <td>DMA</td>
      <td>DMAs</td>
      <td>Admin6</td>
    </tr>
    <tr>
      <th>9</th>
      <td>states</td>
      <td>States</td>
      <td>US.States</td>
      <td>ID</td>
      <td>NAME</td>
      <td>State</td>
      <td>States</td>
      <td>Admin2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>whole_usa</td>
      <td>Entire Country</td>
      <td>US.WholeUSA</td>
      <td>ID</td>
      <td>NAME</td>
      <td>United States of America</td>
      <td>United States of America</td>
      <td>Admin1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Now, we are ready to enrich using ArcGIS Pro with Business Analyst and the USA data pack.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bg_enrich_df</span> <span class="o">=</span> <span class="n">usa_local</span><span class="o">.</span><span class="n">enrich</span><span class="p">(</span><span class="n">block_groups_df</span><span class="p">,</span> <span class="n">enrich_variables</span><span class="o">=</span><span class="n">kv</span><span class="p">,</span> <span class="n">standard_geography_level</span><span class="o">=</span><span class="s1">&#39;block_groups&#39;</span><span class="p">,</span> <span class="n">standard_geography_id_column</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span>

<span class="n">bg_enrich_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">bg_enrich_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Consolidating-into-a-Function">
<h2>Consolidating into a Function<a class="headerlink" href="#Consolidating-into-a-Function" title="Permalink to this headline">¶</a></h2>
<p>All of the above steps, if consolidated into a succicent function only containing the logic necessary to run, can look like the following. Also, although some of the imports below are redundant, I include everything needed in this cell soy you can easily copy this and modify it to suit your needs.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">arcgis.gis</span> <span class="kn">import</span> <span class="n">GIS</span>
<span class="kn">from</span> <span class="nn">arcgis.geoenrichment</span> <span class="kn">import</span> <span class="n">Country</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">enrich_std_geo</span><span class="p">(</span>
    <span class="n">country</span><span class="p">:</span> <span class="n">Country</span><span class="p">,</span>
    <span class="n">geographies</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">std_geo_lvl</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">enrich_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">std_geo_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>

    <span class="c1"># if no enrich variables provided, get the current year key variables</span>
    <span class="k">if</span> <span class="n">enrich_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">enrich_vars</span> <span class="o">=</span> <span class="n">country</span><span class="o">.</span><span class="n">enrich_variables</span><span class="p">[</span>
            <span class="p">(</span><span class="n">country</span><span class="o">.</span><span class="n">enrich_variables</span><span class="o">.</span><span class="n">data_collection</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">))</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">country</span><span class="o">.</span><span class="n">enrich_variables</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;cy&#39;</span><span class="p">))</span>
        <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># invoke enrich method against standard geographies</span>
    <span class="n">enrich_df</span> <span class="o">=</span> <span class="n">country</span><span class="o">.</span><span class="n">enrich</span><span class="p">(</span><span class="n">geographies</span><span class="p">,</span>
                               <span class="n">enrich_variables</span><span class="o">=</span><span class="n">enrich_vars</span><span class="p">,</span>
                               <span class="n">standard_geography_level</span><span class="o">=</span><span class="n">std_geo_lvl</span><span class="p">,</span>
                               <span class="n">standard_geography_id_column</span><span class="o">=</span><span class="n">std_geo_col</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">enrich_df</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Switching-Sources">
<h2>Switching Sources<a class="headerlink" href="#Switching-Sources" title="Permalink to this headline">¶</a></h2>
<p>Using the above function we can easily accomplish all the steps detailed above in one succicent step. Based on this, we can quickly switch between sources by swapping out the <code class="docutils literal notranslate"><span class="pre">Country</span></code> instance. As is evident below, switching sources requires little more than changing the country object. Everything else works the same, and <em>this is the point</em>. This API is designed to enable you to easily work with Business Analyst data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">local_fn_enrich_df</span> <span class="o">=</span> <span class="n">enrich_std_geo</span><span class="p">(</span><span class="n">usa_local</span><span class="p">,</span> <span class="n">geographies</span><span class="o">=</span><span class="n">postal_code_lst</span><span class="p">,</span> <span class="n">std_geo_lvl</span><span class="o">=</span><span class="s1">&#39;zip5&#39;</span><span class="p">)</span>

<span class="n">local_fn_enrich_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">local_fn_enrich_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 13 entries, 0 to 12
Data columns (total 27 columns):
 #   Column                 Non-Null Count  Dtype
---  ------                 --------------  -----
 0   id_field               13 non-null     object
 1   area_desc              13 non-null     object
 2   ta_desc                13 non-null     object
 3   names                  13 non-null     object
 4   has_data               13 non-null     int64
 5   aggregation_method     13 non-null     object
 6   keyusfacts_totpop_cy   13 non-null     float64
 7   keyusfacts_gqpop_cy    13 non-null     float64
 8   keyusfacts_divindx_cy  13 non-null     float64
 9   keyusfacts_tothh_cy    13 non-null     float64
 10  keyusfacts_avghhsz_cy  13 non-null     float64
 11  keyusfacts_medhinc_cy  13 non-null     float64
 12  keyusfacts_avghinc_cy  13 non-null     float64
 13  keyusfacts_pci_cy      13 non-null     float64
 14  keyusfacts_tothu_cy    13 non-null     float64
 15  keyusfacts_owner_cy    13 non-null     float64
 16  keyusfacts_renter_cy   13 non-null     float64
 17  keyusfacts_vacant_cy   13 non-null     float64
 18  keyusfacts_medval_cy   13 non-null     float64
 19  keyusfacts_avgval_cy   13 non-null     float64
 20  keyusfacts_popgrw10cy  13 non-null     float64
 21  keyusfacts_hhgrw10cy   13 non-null     float64
 22  keyusfacts_famgrw10cy  13 non-null     float64
 23  keyusfacts_dpop_cy     13 non-null     float64
 24  keyusfacts_dpopwrk_cy  13 non-null     float64
 25  keyusfacts_dpopres_cy  13 non-null     float64
 26  SHAPE                  13 non-null     geometry
dtypes: float64(20), geometry(1), int64(1), object(5)
memory usage: 2.9+ KB
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_field</th>
      <th>area_desc</th>
      <th>ta_desc</th>
      <th>names</th>
      <th>has_data</th>
      <th>aggregation_method</th>
      <th>keyusfacts_totpop_cy</th>
      <th>keyusfacts_gqpop_cy</th>
      <th>keyusfacts_divindx_cy</th>
      <th>keyusfacts_tothh_cy</th>
      <th>...</th>
      <th>keyusfacts_vacant_cy</th>
      <th>keyusfacts_medval_cy</th>
      <th>keyusfacts_avgval_cy</th>
      <th>keyusfacts_popgrw10cy</th>
      <th>keyusfacts_hhgrw10cy</th>
      <th>keyusfacts_famgrw10cy</th>
      <th>keyusfacts_dpop_cy</th>
      <th>keyusfacts_dpopwrk_cy</th>
      <th>keyusfacts_dpopres_cy</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>83801</td>
      <td>83801</td>
      <td>TA from geography Layer: 83801</td>
      <td>Athol</td>
      <td>1</td>
      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>
      <td>8497.0</td>
      <td>0.0</td>
      <td>13.6</td>
      <td>3142.0</td>
      <td>...</td>
      <td>421.0</td>
      <td>382542.0</td>
      <td>391184.0</td>
      <td>2.07</td>
      <td>2.09</td>
      <td>1.92</td>
      <td>6502.0</td>
      <td>1962.0</td>
      <td>4540.0</td>
      <td>{"rings": [[[-116.69531754199994, 48.075561486...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>83803</td>
      <td>83803</td>
      <td>TA from geography Layer: 83803</td>
      <td>Bayview</td>
      <td>1</td>
      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>
      <td>656.0</td>
      <td>0.0</td>
      <td>10.5</td>
      <td>341.0</td>
      <td>...</td>
      <td>318.0</td>
      <td>391333.0</td>
      <td>403113.0</td>
      <td>1.76</td>
      <td>1.80</td>
      <td>1.56</td>
      <td>499.0</td>
      <td>145.0</td>
      <td>354.0</td>
      <td>{"rings": [[[-116.49664843299996, 47.991467237...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>83810</td>
      <td>83810</td>
      <td>TA from geography Layer: 83810</td>
      <td>Cataldo</td>
      <td>1</td>
      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>
      <td>1090.0</td>
      <td>4.0</td>
      <td>11.7</td>
      <td>479.0</td>
      <td>...</td>
      <td>100.0</td>
      <td>437903.0</td>
      <td>464383.0</td>
      <td>0.94</td>
      <td>0.96</td>
      <td>0.76</td>
      <td>762.0</td>
      <td>246.0</td>
      <td>516.0</td>
      <td>{"rings": [[[-116.40476999999998, 47.612660000...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>83814</td>
      <td>83814</td>
      <td>TA from geography Layer: 83814</td>
      <td>Coeur D Alene</td>
      <td>1</td>
      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>
      <td>28546.0</td>
      <td>609.0</td>
      <td>21.2</td>
      <td>12454.0</td>
      <td>...</td>
      <td>2600.0</td>
      <td>377722.0</td>
      <td>508589.0</td>
      <td>1.86</td>
      <td>1.91</td>
      <td>1.72</td>
      <td>38178.0</td>
      <td>23011.0</td>
      <td>15167.0</td>
      <td>{"rings": [[[-116.58028267699996, 47.744349415...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>83815</td>
      <td>83815</td>
      <td>TA from geography Layer: 83815</td>
      <td>Coeur D Alene</td>
      <td>1</td>
      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>
      <td>38614.0</td>
      <td>617.0</td>
      <td>24.1</td>
      <td>15247.0</td>
      <td>...</td>
      <td>1146.0</td>
      <td>308198.0</td>
      <td>374194.0</td>
      <td>1.79</td>
      <td>1.78</td>
      <td>1.51</td>
      <td>37345.0</td>
      <td>15891.0</td>
      <td>21454.0</td>
      <td>{"rings": [[[-116.69478052499994, 47.725640161...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 27 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agol_fn_enrich_df</span> <span class="o">=</span> <span class="n">enrich_std_geo</span><span class="p">(</span><span class="n">usa_agol</span><span class="p">,</span> <span class="n">geographies</span><span class="o">=</span><span class="n">postal_code_lst</span><span class="p">,</span> <span class="n">std_geo_lvl</span><span class="o">=</span><span class="s1">&#39;zip5&#39;</span><span class="p">)</span>

<span class="n">agol_fn_enrich_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">agol_fn_enrich_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 13 entries, 0 to 12
Data columns (total 29 columns):
 #   Column                             Non-Null Count  Dtype
---  ------                             --------------  -----
 0   std_geography_level                13 non-null     object
 1   std_geography_name                 13 non-null     object
 2   std_geography_id                   13 non-null     object
 3   source_country                     13 non-null     object
 4   aggregation_method                 13 non-null     object
 5   population_to_polygon_size_rating  13 non-null     float64
 6   apportionment_confidence           13 non-null     float64
 7   has_data                           13 non-null     int64
 8   totpop_cy                          13 non-null     int64
 9   gqpop_cy                           13 non-null     int64
 10  divindx_cy                         13 non-null     float64
 11  tothh_cy                           13 non-null     int64
 12  avghhsz_cy                         13 non-null     float64
 13  medhinc_cy                         13 non-null     int64
 14  avghinc_cy                         13 non-null     int64
 15  pci_cy                             13 non-null     int64
 16  tothu_cy                           13 non-null     int64
 17  owner_cy                           13 non-null     int64
 18  renter_cy                          13 non-null     int64
 19  vacant_cy                          13 non-null     int64
 20  medval_cy                          13 non-null     int64
 21  avgval_cy                          13 non-null     int64
 22  popgrw10_cy                        13 non-null     float64
 23  hhgrw10_cy                         13 non-null     float64
 24  famgrw10_cy                        13 non-null     float64
 25  dpop_cy                            13 non-null     int64
 26  dpopwrk_cy                         13 non-null     int64
 27  dpopres_cy                         13 non-null     int64
 28  SHAPE                              13 non-null     geometry
dtypes: float64(7), geometry(1), int64(16), object(5)
memory usage: 3.1+ KB
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>std_geography_level</th>
      <th>std_geography_name</th>
      <th>std_geography_id</th>
      <th>source_country</th>
      <th>aggregation_method</th>
      <th>population_to_polygon_size_rating</th>
      <th>apportionment_confidence</th>
      <th>has_data</th>
      <th>totpop_cy</th>
      <th>gqpop_cy</th>
      <th>...</th>
      <th>vacant_cy</th>
      <th>medval_cy</th>
      <th>avgval_cy</th>
      <th>popgrw10_cy</th>
      <th>hhgrw10_cy</th>
      <th>famgrw10_cy</th>
      <th>dpop_cy</th>
      <th>dpopwrk_cy</th>
      <th>dpopres_cy</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>US.ZIP5</td>
      <td>Athol</td>
      <td>83801</td>
      <td>US</td>
      <td>Query:US.ZIP5</td>
      <td>2.191</td>
      <td>2.576</td>
      <td>1</td>
      <td>8497</td>
      <td>0</td>
      <td>...</td>
      <td>421</td>
      <td>382542</td>
      <td>391184</td>
      <td>2.07</td>
      <td>2.09</td>
      <td>1.92</td>
      <td>6502</td>
      <td>1962</td>
      <td>4540</td>
      <td>{"rings": [[[-116.69531754168734, 48.075561485...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>US.ZIP5</td>
      <td>Bayview</td>
      <td>83803</td>
      <td>US</td>
      <td>Query:US.ZIP5</td>
      <td>2.191</td>
      <td>2.576</td>
      <td>1</td>
      <td>656</td>
      <td>0</td>
      <td>...</td>
      <td>318</td>
      <td>391333</td>
      <td>403113</td>
      <td>1.76</td>
      <td>1.80</td>
      <td>1.56</td>
      <td>499</td>
      <td>145</td>
      <td>354</td>
      <td>{"rings": [[[-116.49664843313857, 47.991467236...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>US.ZIP5</td>
      <td>Cataldo</td>
      <td>83810</td>
      <td>US</td>
      <td>Query:US.ZIP5</td>
      <td>2.191</td>
      <td>2.576</td>
      <td>1</td>
      <td>1090</td>
      <td>4</td>
      <td>...</td>
      <td>100</td>
      <td>439516</td>
      <td>465172</td>
      <td>0.94</td>
      <td>0.96</td>
      <td>0.76</td>
      <td>762</td>
      <td>246</td>
      <td>516</td>
      <td>{"rings": [[[-116.40476999992698, 47.612659999...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>US.ZIP5</td>
      <td>Coeur D Alene</td>
      <td>83814</td>
      <td>US</td>
      <td>Query:US.ZIP5</td>
      <td>2.191</td>
      <td>2.576</td>
      <td>1</td>
      <td>28546</td>
      <td>609</td>
      <td>...</td>
      <td>2600</td>
      <td>377722</td>
      <td>508589</td>
      <td>1.86</td>
      <td>1.91</td>
      <td>1.72</td>
      <td>38109</td>
      <td>22942</td>
      <td>15167</td>
      <td>{"rings": [[[-116.58028267664488, 47.744349414...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>US.ZIP5</td>
      <td>Coeur D Alene</td>
      <td>83815</td>
      <td>US</td>
      <td>Query:US.ZIP5</td>
      <td>2.191</td>
      <td>2.576</td>
      <td>1</td>
      <td>38614</td>
      <td>617</td>
      <td>...</td>
      <td>1146</td>
      <td>308198</td>
      <td>374194</td>
      <td>1.79</td>
      <td>1.78</td>
      <td>1.51</td>
      <td>37345</td>
      <td>15891</td>
      <td>21454</td>
      <td>{"rings": [[[-116.69790643782714, 47.729762324...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 29 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2021, Joel McCune.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/notebooks/preprocessing-enrich-std-geo.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>