{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Enrich Using Point Geometries"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Starting off, we import a few required Python resources. While there are quite a few in there, the import of note is `from arcgis.geoenrichment import Country, get_countries`. We are going to use this object and method to discover and perform our analysis."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "from pathlib import Path\n",
    "\n",
    "from arcgis.features import GeoAccessor\n",
    "from arcgis.geoenrichment import Country\n",
    "from arcgis.geometry import Geometry\n",
    "from arcgis.gis import GIS\n",
    "from dotenv import load_dotenv, find_dotenv\n",
    "from IPython.display import IFrame\n",
    "import pandas as pd"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next, we need some test data to work with. For the sake of simplicity, we are going to create two point geometries on the fly and build a Spatially Enabled Data Frame with these two points. We are going to investigate how to get very similar results by inputting just the list of point `Geometry` objects and also these geometries as part of a Spatially Enabled Data Frame."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>store_name</th>\n",
       "      <th>SHAPE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Bayview</td>\n",
       "      <td>{\"x\": -122.9074835, \"y\": 47.0450249, \"spatialR...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Ralph's Thriftway</td>\n",
       "      <td>{\"x\": -122.87496, \"y\": 47.0464031, \"spatialRef...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          store_name                                              SHAPE\n",
       "0            Bayview  {\"x\": -122.9074835, \"y\": 47.0450249, \"spatialR...\n",
       "1  Ralph's Thriftway  {\"x\": -122.87496, \"y\": 47.0464031, \"spatialRef..."
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "nm_lst = ['Bayview', \"Ralph's Thriftway\"]\n",
    "coord_lst = [\n",
    "    (-122.9074835, 47.0450249),  # Bayview Grocery Store\n",
    "    (-122.8749600, 47.0464031)   # Ralph's Thriftway Grocery Store\n",
    "]\n",
    "\n",
    "# create a list of point geometry objects from the coordinate tuples - what we are going to use first\n",
    "geom_lst = [Geometry({'x': pt[0], 'y': pt[1], 'spatialReference': {'wkid': 4326}}) for pt in coord_lst]\n",
    "\n",
    "# create a spatially enabled dataframe - what we are going to use later\n",
    "grocery_df = pd.DataFrame(zip(nm_lst, geom_lst), columns=['store_name', 'SHAPE'])\n",
    "grocery_df.spatial.set_geometry('SHAPE')\n",
    "grocery_df"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now, we are going to need a connection to ArcGIS Online to demonstrate the abiliy to use ArcGIS Online for geoenrichment. This is accomplished by instantiating a `GIS` object instance with valid credentials read from environment variables."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "GIS @ <a href=\"https://www.arcgis.com\">https://www.arcgis.com</a>"
      ],
      "text/plain": [
       "GIS @ https://www.arcgis.com version:9.4"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gis_agol = GIS(\n",
    "    url=os.getenv('ESRI_GIS_URL'), \n",
    "    username=os.getenv('ESRI_GIS_USERNAME'),\n",
    "    password=os.getenv('ESRI_GIS_PASSWORD')\n",
    ")\n",
    "\n",
    "gis_agol"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Point List Using Defaults"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "To enrich, we start by creating a `Country` object instance. As part of the constructor, we need to tell the object what Business Analyst source to use in the `gis` parameter. In this case, we are telling the object to use a local instance of ArcGIS Pro with Business Analyst and the United States data pack."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<Country - United States 2021 ('local')>"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "usa_local = Country('usa', gis=GIS('pro'))\n",
    "\n",
    "usa_local"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next, we need to get some enrich variables to use. We can discover what is available using the `enrich_variables` property of the country object to retrieve a Pandas Data Frame of variables available for the country."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>name</th>\n",
       "      <th>alias</th>\n",
       "      <th>data_collection</th>\n",
       "      <th>enrich_name</th>\n",
       "      <th>enrich_field_name</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>CHILD_CY</td>\n",
       "      <td>2021 Child Population</td>\n",
       "      <td>AgeDependency</td>\n",
       "      <td>AgeDependency.CHILD_CY</td>\n",
       "      <td>AgeDependency_CHILD_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>WORKAGE_CY</td>\n",
       "      <td>2021 Working-Age Population</td>\n",
       "      <td>AgeDependency</td>\n",
       "      <td>AgeDependency.WORKAGE_CY</td>\n",
       "      <td>AgeDependency_WORKAGE_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>SENIOR_CY</td>\n",
       "      <td>2021 Senior Population</td>\n",
       "      <td>AgeDependency</td>\n",
       "      <td>AgeDependency.SENIOR_CY</td>\n",
       "      <td>AgeDependency_SENIOR_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>CHLDDEP_CY</td>\n",
       "      <td>2021 Child Dependency Ratio</td>\n",
       "      <td>AgeDependency</td>\n",
       "      <td>AgeDependency.CHLDDEP_CY</td>\n",
       "      <td>AgeDependency_CHLDDEP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>AGEDEP_CY</td>\n",
       "      <td>2021 Age Dependency Ratio</td>\n",
       "      <td>AgeDependency</td>\n",
       "      <td>AgeDependency.AGEDEP_CY</td>\n",
       "      <td>AgeDependency_AGEDEP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17958</th>\n",
       "      <td>MOEMEDYRMV</td>\n",
       "      <td>2019 Median Year Householder Moved In MOE (ACS...</td>\n",
       "      <td>yearmovedin</td>\n",
       "      <td>yearmovedin.MOEMEDYRMV</td>\n",
       "      <td>yearmovedin_MOEMEDYRMV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17959</th>\n",
       "      <td>RELMEDYRMV</td>\n",
       "      <td>2019 Median Year Householder Moved In REL (ACS...</td>\n",
       "      <td>yearmovedin</td>\n",
       "      <td>yearmovedin.RELMEDYRMV</td>\n",
       "      <td>yearmovedin_RELMEDYRMV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17960</th>\n",
       "      <td>ACSOWNER</td>\n",
       "      <td>2019 Owner Households (ACS 5-Yr)</td>\n",
       "      <td>yearmovedin</td>\n",
       "      <td>yearmovedin.ACSOWNER</td>\n",
       "      <td>yearmovedin_ACSOWNER</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17961</th>\n",
       "      <td>MOEOWNER</td>\n",
       "      <td>2019 Owner Households MOE (ACS 5-Yr)</td>\n",
       "      <td>yearmovedin</td>\n",
       "      <td>yearmovedin.MOEOWNER</td>\n",
       "      <td>yearmovedin_MOEOWNER</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17962</th>\n",
       "      <td>RELOWNER</td>\n",
       "      <td>2019 Owner Households REL (ACS 5-Yr)</td>\n",
       "      <td>yearmovedin</td>\n",
       "      <td>yearmovedin.RELOWNER</td>\n",
       "      <td>yearmovedin_RELOWNER</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>17963 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "             name                                              alias  \\\n",
       "0        CHILD_CY                              2021 Child Population   \n",
       "1      WORKAGE_CY                        2021 Working-Age Population   \n",
       "2       SENIOR_CY                             2021 Senior Population   \n",
       "3      CHLDDEP_CY                        2021 Child Dependency Ratio   \n",
       "4       AGEDEP_CY                          2021 Age Dependency Ratio   \n",
       "...           ...                                                ...   \n",
       "17958  MOEMEDYRMV  2019 Median Year Householder Moved In MOE (ACS...   \n",
       "17959  RELMEDYRMV  2019 Median Year Householder Moved In REL (ACS...   \n",
       "17960    ACSOWNER                   2019 Owner Households (ACS 5-Yr)   \n",
       "17961    MOEOWNER               2019 Owner Households MOE (ACS 5-Yr)   \n",
       "17962    RELOWNER               2019 Owner Households REL (ACS 5-Yr)   \n",
       "\n",
       "      data_collection               enrich_name         enrich_field_name  \n",
       "0       AgeDependency    AgeDependency.CHILD_CY    AgeDependency_CHILD_CY  \n",
       "1       AgeDependency  AgeDependency.WORKAGE_CY  AgeDependency_WORKAGE_CY  \n",
       "2       AgeDependency   AgeDependency.SENIOR_CY   AgeDependency_SENIOR_CY  \n",
       "3       AgeDependency  AgeDependency.CHLDDEP_CY  AgeDependency_CHLDDEP_CY  \n",
       "4       AgeDependency   AgeDependency.AGEDEP_CY   AgeDependency_AGEDEP_CY  \n",
       "...               ...                       ...                       ...  \n",
       "17958     yearmovedin    yearmovedin.MOEMEDYRMV    yearmovedin_MOEMEDYRMV  \n",
       "17959     yearmovedin    yearmovedin.RELMEDYRMV    yearmovedin_RELMEDYRMV  \n",
       "17960     yearmovedin      yearmovedin.ACSOWNER      yearmovedin_ACSOWNER  \n",
       "17961     yearmovedin      yearmovedin.MOEOWNER      yearmovedin_MOEOWNER  \n",
       "17962     yearmovedin      yearmovedin.RELOWNER      yearmovedin_RELOWNER  \n",
       "\n",
       "[17963 rows x 5 columns]"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ev = usa_local.enrich_variables\n",
    "\n",
    "ev"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Tens of thousands of variables is just a few too many to deal with, so we can parse this down a bit using some Pandas Data Frame filtering to get just key United States variables for the current year."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>name</th>\n",
       "      <th>alias</th>\n",
       "      <th>data_collection</th>\n",
       "      <th>enrich_name</th>\n",
       "      <th>enrich_field_name</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>TOTPOP_CY</td>\n",
       "      <td>2021 Total Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.TOTPOP_CY</td>\n",
       "      <td>KeyUSFacts_TOTPOP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>GQPOP_CY</td>\n",
       "      <td>2021 Group Quarters Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.GQPOP_CY</td>\n",
       "      <td>KeyUSFacts_GQPOP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>DIVINDX_CY</td>\n",
       "      <td>2021 Diversity Index</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DIVINDX_CY</td>\n",
       "      <td>KeyUSFacts_DIVINDX_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>TOTHH_CY</td>\n",
       "      <td>2021 Total Households</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.TOTHH_CY</td>\n",
       "      <td>KeyUSFacts_TOTHH_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>AVGHHSZ_CY</td>\n",
       "      <td>2021 Average Household Size</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.AVGHHSZ_CY</td>\n",
       "      <td>KeyUSFacts_AVGHHSZ_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>MEDHINC_CY</td>\n",
       "      <td>2021 Median Household Income</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.MEDHINC_CY</td>\n",
       "      <td>KeyUSFacts_MEDHINC_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>AVGHINC_CY</td>\n",
       "      <td>2021 Average Household Income</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.AVGHINC_CY</td>\n",
       "      <td>KeyUSFacts_AVGHINC_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>PCI_CY</td>\n",
       "      <td>2021 Per Capita Income</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.PCI_CY</td>\n",
       "      <td>KeyUSFacts_PCI_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>TOTHU_CY</td>\n",
       "      <td>2021 Total Housing Units</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.TOTHU_CY</td>\n",
       "      <td>KeyUSFacts_TOTHU_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>OWNER_CY</td>\n",
       "      <td>2021 Owner Occupied HUs</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.OWNER_CY</td>\n",
       "      <td>KeyUSFacts_OWNER_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>RENTER_CY</td>\n",
       "      <td>2021 Renter Occupied HUs</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.RENTER_CY</td>\n",
       "      <td>KeyUSFacts_RENTER_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>VACANT_CY</td>\n",
       "      <td>2021 Vacant Housing Units</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.VACANT_CY</td>\n",
       "      <td>KeyUSFacts_VACANT_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>MEDVAL_CY</td>\n",
       "      <td>2021 Median Home Value</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.MEDVAL_CY</td>\n",
       "      <td>KeyUSFacts_MEDVAL_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>AVGVAL_CY</td>\n",
       "      <td>2021 Average Home Value</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.AVGVAL_CY</td>\n",
       "      <td>KeyUSFacts_AVGVAL_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>POPGRW10CY</td>\n",
       "      <td>2010-2021 Growth Rate: Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.POPGRW10CY</td>\n",
       "      <td>KeyUSFacts_POPGRW10CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>HHGRW10CY</td>\n",
       "      <td>2010-2021 Growth Rate: Households</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.HHGRW10CY</td>\n",
       "      <td>KeyUSFacts_HHGRW10CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>FAMGRW10CY</td>\n",
       "      <td>2010-2021 Growth Rate: Families</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.FAMGRW10CY</td>\n",
       "      <td>KeyUSFacts_FAMGRW10CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>DPOP_CY</td>\n",
       "      <td>2021 Total Daytime Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DPOP_CY</td>\n",
       "      <td>KeyUSFacts_DPOP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>DPOPWRK_CY</td>\n",
       "      <td>2021 Daytime Pop: Workers</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DPOPWRK_CY</td>\n",
       "      <td>KeyUSFacts_DPOPWRK_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>DPOPRES_CY</td>\n",
       "      <td>2021 Daytime Pop: Residents</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DPOPRES_CY</td>\n",
       "      <td>KeyUSFacts_DPOPRES_CY</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          name                              alias data_collection  \\\n",
       "0    TOTPOP_CY              2021 Total Population      KeyUSFacts   \n",
       "1     GQPOP_CY     2021 Group Quarters Population      KeyUSFacts   \n",
       "2   DIVINDX_CY               2021 Diversity Index      KeyUSFacts   \n",
       "3     TOTHH_CY              2021 Total Households      KeyUSFacts   \n",
       "4   AVGHHSZ_CY        2021 Average Household Size      KeyUSFacts   \n",
       "5   MEDHINC_CY       2021 Median Household Income      KeyUSFacts   \n",
       "6   AVGHINC_CY      2021 Average Household Income      KeyUSFacts   \n",
       "7       PCI_CY             2021 Per Capita Income      KeyUSFacts   \n",
       "8     TOTHU_CY           2021 Total Housing Units      KeyUSFacts   \n",
       "9     OWNER_CY            2021 Owner Occupied HUs      KeyUSFacts   \n",
       "10   RENTER_CY           2021 Renter Occupied HUs      KeyUSFacts   \n",
       "11   VACANT_CY          2021 Vacant Housing Units      KeyUSFacts   \n",
       "12   MEDVAL_CY             2021 Median Home Value      KeyUSFacts   \n",
       "13   AVGVAL_CY            2021 Average Home Value      KeyUSFacts   \n",
       "14  POPGRW10CY  2010-2021 Growth Rate: Population      KeyUSFacts   \n",
       "15   HHGRW10CY  2010-2021 Growth Rate: Households      KeyUSFacts   \n",
       "16  FAMGRW10CY    2010-2021 Growth Rate: Families      KeyUSFacts   \n",
       "17     DPOP_CY      2021 Total Daytime Population      KeyUSFacts   \n",
       "18  DPOPWRK_CY          2021 Daytime Pop: Workers      KeyUSFacts   \n",
       "19  DPOPRES_CY        2021 Daytime Pop: Residents      KeyUSFacts   \n",
       "\n",
       "              enrich_name      enrich_field_name  \n",
       "0    KeyUSFacts.TOTPOP_CY   KeyUSFacts_TOTPOP_CY  \n",
       "1     KeyUSFacts.GQPOP_CY    KeyUSFacts_GQPOP_CY  \n",
       "2   KeyUSFacts.DIVINDX_CY  KeyUSFacts_DIVINDX_CY  \n",
       "3     KeyUSFacts.TOTHH_CY    KeyUSFacts_TOTHH_CY  \n",
       "4   KeyUSFacts.AVGHHSZ_CY  KeyUSFacts_AVGHHSZ_CY  \n",
       "5   KeyUSFacts.MEDHINC_CY  KeyUSFacts_MEDHINC_CY  \n",
       "6   KeyUSFacts.AVGHINC_CY  KeyUSFacts_AVGHINC_CY  \n",
       "7       KeyUSFacts.PCI_CY      KeyUSFacts_PCI_CY  \n",
       "8     KeyUSFacts.TOTHU_CY    KeyUSFacts_TOTHU_CY  \n",
       "9     KeyUSFacts.OWNER_CY    KeyUSFacts_OWNER_CY  \n",
       "10   KeyUSFacts.RENTER_CY   KeyUSFacts_RENTER_CY  \n",
       "11   KeyUSFacts.VACANT_CY   KeyUSFacts_VACANT_CY  \n",
       "12   KeyUSFacts.MEDVAL_CY   KeyUSFacts_MEDVAL_CY  \n",
       "13   KeyUSFacts.AVGVAL_CY   KeyUSFacts_AVGVAL_CY  \n",
       "14  KeyUSFacts.POPGRW10CY  KeyUSFacts_POPGRW10CY  \n",
       "15   KeyUSFacts.HHGRW10CY   KeyUSFacts_HHGRW10CY  \n",
       "16  KeyUSFacts.FAMGRW10CY  KeyUSFacts_FAMGRW10CY  \n",
       "17     KeyUSFacts.DPOP_CY     KeyUSFacts_DPOP_CY  \n",
       "18  KeyUSFacts.DPOPWRK_CY  KeyUSFacts_DPOPWRK_CY  \n",
       "19  KeyUSFacts.DPOPRES_CY  KeyUSFacts_DPOPRES_CY  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "kv = ev[\n",
    "    (ev.data_collection.str.lower().str.contains('key'))\n",
    "    & (ev.name.str.lower().str.endswith('cy'))\n",
    "].reset_index(drop=True)\n",
    "\n",
    "kv"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Finally, we can enrich using the points and variables collected above. Please notice, we are not specifying the area around the input points, so we the proximity defaults are being used - a straight line distance of one kilometer around the points. This circular area is then used to apportion data to the locations specified by the point geometries."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 2 entries, 0 to 1\n",
      "Data columns (total 27 columns):\n",
      " #   Column                 Non-Null Count  Dtype   \n",
      "---  ------                 --------------  -----   \n",
      " 0   has_data               2 non-null      int64   \n",
      " 1   area_type              2 non-null      object  \n",
      " 2   buffer_units           2 non-null      object  \n",
      " 3   buffer_unit            2 non-null      object  \n",
      " 4   buffer_radii           2 non-null      float64 \n",
      " 5   aggregation_method     2 non-null      object  \n",
      " 6   keyusfacts_totpop_cy   2 non-null      float64 \n",
      " 7   keyusfacts_gqpop_cy    2 non-null      float64 \n",
      " 8   keyusfacts_divindx_cy  2 non-null      float64 \n",
      " 9   keyusfacts_tothh_cy    2 non-null      float64 \n",
      " 10  keyusfacts_avghhsz_cy  2 non-null      float64 \n",
      " 11  keyusfacts_medhinc_cy  2 non-null      float64 \n",
      " 12  keyusfacts_avghinc_cy  2 non-null      float64 \n",
      " 13  keyusfacts_pci_cy      2 non-null      float64 \n",
      " 14  keyusfacts_tothu_cy    2 non-null      float64 \n",
      " 15  keyusfacts_owner_cy    2 non-null      float64 \n",
      " 16  keyusfacts_renter_cy   2 non-null      float64 \n",
      " 17  keyusfacts_vacant_cy   2 non-null      float64 \n",
      " 18  keyusfacts_medval_cy   2 non-null      float64 \n",
      " 19  keyusfacts_avgval_cy   2 non-null      float64 \n",
      " 20  keyusfacts_popgrw10cy  2 non-null      float64 \n",
      " 21  keyusfacts_hhgrw10cy   2 non-null      float64 \n",
      " 22  keyusfacts_famgrw10cy  2 non-null      float64 \n",
      " 23  keyusfacts_dpop_cy     2 non-null      float64 \n",
      " 24  keyusfacts_dpopwrk_cy  2 non-null      float64 \n",
      " 25  keyusfacts_dpopres_cy  2 non-null      float64 \n",
      " 26  SHAPE                  2 non-null      geometry\n",
      "dtypes: float64(21), geometry(1), int64(1), object(4)\n",
      "memory usage: 560.0+ bytes\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>has_data</th>\n",
       "      <th>area_type</th>\n",
       "      <th>buffer_units</th>\n",
       "      <th>buffer_unit</th>\n",
       "      <th>buffer_radii</th>\n",
       "      <th>aggregation_method</th>\n",
       "      <th>keyusfacts_totpop_cy</th>\n",
       "      <th>keyusfacts_gqpop_cy</th>\n",
       "      <th>keyusfacts_divindx_cy</th>\n",
       "      <th>keyusfacts_tothh_cy</th>\n",
       "      <th>...</th>\n",
       "      <th>keyusfacts_vacant_cy</th>\n",
       "      <th>keyusfacts_medval_cy</th>\n",
       "      <th>keyusfacts_avgval_cy</th>\n",
       "      <th>keyusfacts_popgrw10cy</th>\n",
       "      <th>keyusfacts_hhgrw10cy</th>\n",
       "      <th>keyusfacts_famgrw10cy</th>\n",
       "      <th>keyusfacts_dpop_cy</th>\n",
       "      <th>keyusfacts_dpopwrk_cy</th>\n",
       "      <th>keyusfacts_dpopres_cy</th>\n",
       "      <th>SHAPE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>RingBuffer</td>\n",
       "      <td>esriKilometers</td>\n",
       "      <td>esriKilometers</td>\n",
       "      <td>1.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>2706.0</td>\n",
       "      <td>66.0</td>\n",
       "      <td>38.6</td>\n",
       "      <td>1727.0</td>\n",
       "      <td>...</td>\n",
       "      <td>218.0</td>\n",
       "      <td>381908.0</td>\n",
       "      <td>419728.0</td>\n",
       "      <td>1.46</td>\n",
       "      <td>1.74</td>\n",
       "      <td>1.08</td>\n",
       "      <td>7604.0</td>\n",
       "      <td>6222.0</td>\n",
       "      <td>1382.0</td>\n",
       "      <td>{\"x\": -122.90748349999996, \"y\": 47.04502490000...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>RingBuffer</td>\n",
       "      <td>esriKilometers</td>\n",
       "      <td>esriKilometers</td>\n",
       "      <td>1.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>4672.0</td>\n",
       "      <td>75.0</td>\n",
       "      <td>41.8</td>\n",
       "      <td>2145.0</td>\n",
       "      <td>...</td>\n",
       "      <td>116.0</td>\n",
       "      <td>323665.0</td>\n",
       "      <td>360023.0</td>\n",
       "      <td>0.73</td>\n",
       "      <td>0.71</td>\n",
       "      <td>0.54</td>\n",
       "      <td>4623.0</td>\n",
       "      <td>2558.0</td>\n",
       "      <td>2065.0</td>\n",
       "      <td>{\"x\": -122.87495999999999, \"y\": 47.04640310000...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2 rows × 27 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   has_data   area_type    buffer_units     buffer_unit  buffer_radii  \\\n",
       "0         1  RingBuffer  esriKilometers  esriKilometers           1.0   \n",
       "1         1  RingBuffer  esriKilometers  esriKilometers           1.0   \n",
       "\n",
       "                                  aggregation_method  keyusfacts_totpop_cy  \\\n",
       "0  BlockApportionment:US.BlockGroups;PointsLayer:...                2706.0   \n",
       "1  BlockApportionment:US.BlockGroups;PointsLayer:...                4672.0   \n",
       "\n",
       "   keyusfacts_gqpop_cy  keyusfacts_divindx_cy  keyusfacts_tothh_cy  ...  \\\n",
       "0                 66.0                   38.6               1727.0  ...   \n",
       "1                 75.0                   41.8               2145.0  ...   \n",
       "\n",
       "   keyusfacts_vacant_cy  keyusfacts_medval_cy  keyusfacts_avgval_cy  \\\n",
       "0                 218.0              381908.0              419728.0   \n",
       "1                 116.0              323665.0              360023.0   \n",
       "\n",
       "   keyusfacts_popgrw10cy  keyusfacts_hhgrw10cy  keyusfacts_famgrw10cy  \\\n",
       "0                   1.46                  1.74                   1.08   \n",
       "1                   0.73                  0.71                   0.54   \n",
       "\n",
       "   keyusfacts_dpop_cy  keyusfacts_dpopwrk_cy  keyusfacts_dpopres_cy  \\\n",
       "0              7604.0                 6222.0                 1382.0   \n",
       "1              4623.0                 2558.0                 2065.0   \n",
       "\n",
       "                                               SHAPE  \n",
       "0  {\"x\": -122.90748349999996, \"y\": 47.04502490000...  \n",
       "1  {\"x\": -122.87495999999999, \"y\": 47.04640310000...  \n",
       "\n",
       "[2 rows x 27 columns]"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pt1_enrich_df = usa_local.enrich(\n",
    "    geographies=geom_lst,\n",
    "    enrich_variables=kv\n",
    ")\n",
    "\n",
    "pt1_enrich_df.info()\n",
    "pt1_enrich_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Specify Proximity Value\n",
    "\n",
    "If wanting to use a value different from the default of one kilometer (highly recommended), this can easily be specified using the `proximity_value` parameter."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 2 entries, 0 to 1\n",
      "Data columns (total 27 columns):\n",
      " #   Column                 Non-Null Count  Dtype   \n",
      "---  ------                 --------------  -----   \n",
      " 0   has_data               2 non-null      int64   \n",
      " 1   area_type              2 non-null      object  \n",
      " 2   buffer_units           2 non-null      object  \n",
      " 3   buffer_unit            2 non-null      object  \n",
      " 4   buffer_radii           2 non-null      float64 \n",
      " 5   aggregation_method     2 non-null      object  \n",
      " 6   keyusfacts_totpop_cy   2 non-null      float64 \n",
      " 7   keyusfacts_gqpop_cy    2 non-null      float64 \n",
      " 8   keyusfacts_divindx_cy  2 non-null      float64 \n",
      " 9   keyusfacts_tothh_cy    2 non-null      float64 \n",
      " 10  keyusfacts_avghhsz_cy  2 non-null      float64 \n",
      " 11  keyusfacts_medhinc_cy  2 non-null      float64 \n",
      " 12  keyusfacts_avghinc_cy  2 non-null      float64 \n",
      " 13  keyusfacts_pci_cy      2 non-null      float64 \n",
      " 14  keyusfacts_tothu_cy    2 non-null      float64 \n",
      " 15  keyusfacts_owner_cy    2 non-null      float64 \n",
      " 16  keyusfacts_renter_cy   2 non-null      float64 \n",
      " 17  keyusfacts_vacant_cy   2 non-null      float64 \n",
      " 18  keyusfacts_medval_cy   2 non-null      float64 \n",
      " 19  keyusfacts_avgval_cy   2 non-null      float64 \n",
      " 20  keyusfacts_popgrw10cy  2 non-null      float64 \n",
      " 21  keyusfacts_hhgrw10cy   2 non-null      float64 \n",
      " 22  keyusfacts_famgrw10cy  2 non-null      float64 \n",
      " 23  keyusfacts_dpop_cy     2 non-null      float64 \n",
      " 24  keyusfacts_dpopwrk_cy  2 non-null      float64 \n",
      " 25  keyusfacts_dpopres_cy  2 non-null      float64 \n",
      " 26  SHAPE                  2 non-null      geometry\n",
      "dtypes: float64(21), geometry(1), int64(1), object(4)\n",
      "memory usage: 560.0+ bytes\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>has_data</th>\n",
       "      <th>area_type</th>\n",
       "      <th>buffer_units</th>\n",
       "      <th>buffer_unit</th>\n",
       "      <th>buffer_radii</th>\n",
       "      <th>aggregation_method</th>\n",
       "      <th>keyusfacts_totpop_cy</th>\n",
       "      <th>keyusfacts_gqpop_cy</th>\n",
       "      <th>keyusfacts_divindx_cy</th>\n",
       "      <th>keyusfacts_tothh_cy</th>\n",
       "      <th>...</th>\n",
       "      <th>keyusfacts_vacant_cy</th>\n",
       "      <th>keyusfacts_medval_cy</th>\n",
       "      <th>keyusfacts_avgval_cy</th>\n",
       "      <th>keyusfacts_popgrw10cy</th>\n",
       "      <th>keyusfacts_hhgrw10cy</th>\n",
       "      <th>keyusfacts_famgrw10cy</th>\n",
       "      <th>keyusfacts_dpop_cy</th>\n",
       "      <th>keyusfacts_dpopwrk_cy</th>\n",
       "      <th>keyusfacts_dpopres_cy</th>\n",
       "      <th>SHAPE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>RingBuffer</td>\n",
       "      <td>esriKilometers</td>\n",
       "      <td>esriKilometers</td>\n",
       "      <td>5.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>67415.0</td>\n",
       "      <td>1265.0</td>\n",
       "      <td>45.4</td>\n",
       "      <td>29537.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1431.0</td>\n",
       "      <td>371293.0</td>\n",
       "      <td>415153.0</td>\n",
       "      <td>1.59</td>\n",
       "      <td>1.57</td>\n",
       "      <td>1.44</td>\n",
       "      <td>82942.0</td>\n",
       "      <td>50340.0</td>\n",
       "      <td>32602.0</td>\n",
       "      <td>{\"x\": -122.90748349999996, \"y\": 47.04502490000...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>RingBuffer</td>\n",
       "      <td>esriKilometers</td>\n",
       "      <td>esriKilometers</td>\n",
       "      <td>5.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>70224.0</td>\n",
       "      <td>1350.0</td>\n",
       "      <td>48.5</td>\n",
       "      <td>30852.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1636.0</td>\n",
       "      <td>369053.0</td>\n",
       "      <td>415710.0</td>\n",
       "      <td>0.99</td>\n",
       "      <td>1.01</td>\n",
       "      <td>0.87</td>\n",
       "      <td>89116.0</td>\n",
       "      <td>54806.0</td>\n",
       "      <td>34310.0</td>\n",
       "      <td>{\"x\": -122.87495999999999, \"y\": 47.04640310000...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2 rows × 27 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   has_data   area_type    buffer_units     buffer_unit  buffer_radii  \\\n",
       "0         1  RingBuffer  esriKilometers  esriKilometers           5.0   \n",
       "1         1  RingBuffer  esriKilometers  esriKilometers           5.0   \n",
       "\n",
       "                                  aggregation_method  keyusfacts_totpop_cy  \\\n",
       "0  BlockApportionment:US.BlockGroups;PointsLayer:...               67415.0   \n",
       "1  BlockApportionment:US.BlockGroups;PointsLayer:...               70224.0   \n",
       "\n",
       "   keyusfacts_gqpop_cy  keyusfacts_divindx_cy  keyusfacts_tothh_cy  ...  \\\n",
       "0               1265.0                   45.4              29537.0  ...   \n",
       "1               1350.0                   48.5              30852.0  ...   \n",
       "\n",
       "   keyusfacts_vacant_cy  keyusfacts_medval_cy  keyusfacts_avgval_cy  \\\n",
       "0                1431.0              371293.0              415153.0   \n",
       "1                1636.0              369053.0              415710.0   \n",
       "\n",
       "   keyusfacts_popgrw10cy  keyusfacts_hhgrw10cy  keyusfacts_famgrw10cy  \\\n",
       "0                   1.59                  1.57                   1.44   \n",
       "1                   0.99                  1.01                   0.87   \n",
       "\n",
       "   keyusfacts_dpop_cy  keyusfacts_dpopwrk_cy  keyusfacts_dpopres_cy  \\\n",
       "0             82942.0                50340.0                32602.0   \n",
       "1             89116.0                54806.0                34310.0   \n",
       "\n",
       "                                               SHAPE  \n",
       "0  {\"x\": -122.90748349999996, \"y\": 47.04502490000...  \n",
       "1  {\"x\": -122.87495999999999, \"y\": 47.04640310000...  \n",
       "\n",
       "[2 rows x 27 columns]"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pt2_enrich_df = usa_local.enrich(\n",
    "    geographies=geom_lst,\n",
    "    enrich_variables=kv,\n",
    "    proximity_value=5\n",
    ")\n",
    "\n",
    "pt2_enrich_df.info()\n",
    "pt2_enrich_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Specify Proximity Value and Metric\n",
    "\n",
    "If desiring to use a different measure of distance, such as miles, this can be specified as well using the `proximity_metric` parameter."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 2 entries, 0 to 1\n",
      "Data columns (total 27 columns):\n",
      " #   Column                 Non-Null Count  Dtype   \n",
      "---  ------                 --------------  -----   \n",
      " 0   has_data               2 non-null      int64   \n",
      " 1   area_type              2 non-null      object  \n",
      " 2   buffer_units           2 non-null      object  \n",
      " 3   buffer_unit            2 non-null      object  \n",
      " 4   buffer_radii           2 non-null      float64 \n",
      " 5   aggregation_method     2 non-null      object  \n",
      " 6   keyusfacts_totpop_cy   2 non-null      float64 \n",
      " 7   keyusfacts_gqpop_cy    2 non-null      float64 \n",
      " 8   keyusfacts_divindx_cy  2 non-null      float64 \n",
      " 9   keyusfacts_tothh_cy    2 non-null      float64 \n",
      " 10  keyusfacts_avghhsz_cy  2 non-null      float64 \n",
      " 11  keyusfacts_medhinc_cy  2 non-null      float64 \n",
      " 12  keyusfacts_avghinc_cy  2 non-null      float64 \n",
      " 13  keyusfacts_pci_cy      2 non-null      float64 \n",
      " 14  keyusfacts_tothu_cy    2 non-null      float64 \n",
      " 15  keyusfacts_owner_cy    2 non-null      float64 \n",
      " 16  keyusfacts_renter_cy   2 non-null      float64 \n",
      " 17  keyusfacts_vacant_cy   2 non-null      float64 \n",
      " 18  keyusfacts_medval_cy   2 non-null      float64 \n",
      " 19  keyusfacts_avgval_cy   2 non-null      float64 \n",
      " 20  keyusfacts_popgrw10cy  2 non-null      float64 \n",
      " 21  keyusfacts_hhgrw10cy   2 non-null      float64 \n",
      " 22  keyusfacts_famgrw10cy  2 non-null      float64 \n",
      " 23  keyusfacts_dpop_cy     2 non-null      float64 \n",
      " 24  keyusfacts_dpopwrk_cy  2 non-null      float64 \n",
      " 25  keyusfacts_dpopres_cy  2 non-null      float64 \n",
      " 26  SHAPE                  2 non-null      geometry\n",
      "dtypes: float64(21), geometry(1), int64(1), object(4)\n",
      "memory usage: 560.0+ bytes\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>has_data</th>\n",
       "      <th>area_type</th>\n",
       "      <th>buffer_units</th>\n",
       "      <th>buffer_unit</th>\n",
       "      <th>buffer_radii</th>\n",
       "      <th>aggregation_method</th>\n",
       "      <th>keyusfacts_totpop_cy</th>\n",
       "      <th>keyusfacts_gqpop_cy</th>\n",
       "      <th>keyusfacts_divindx_cy</th>\n",
       "      <th>keyusfacts_tothh_cy</th>\n",
       "      <th>...</th>\n",
       "      <th>keyusfacts_vacant_cy</th>\n",
       "      <th>keyusfacts_medval_cy</th>\n",
       "      <th>keyusfacts_avgval_cy</th>\n",
       "      <th>keyusfacts_popgrw10cy</th>\n",
       "      <th>keyusfacts_hhgrw10cy</th>\n",
       "      <th>keyusfacts_famgrw10cy</th>\n",
       "      <th>keyusfacts_dpop_cy</th>\n",
       "      <th>keyusfacts_dpopwrk_cy</th>\n",
       "      <th>keyusfacts_dpopres_cy</th>\n",
       "      <th>SHAPE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>RingBuffer</td>\n",
       "      <td>esriMiles</td>\n",
       "      <td>esriMiles</td>\n",
       "      <td>5.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>121938.0</td>\n",
       "      <td>2969.0</td>\n",
       "      <td>47.4</td>\n",
       "      <td>51980.0</td>\n",
       "      <td>...</td>\n",
       "      <td>2798.0</td>\n",
       "      <td>370690.0</td>\n",
       "      <td>428025.0</td>\n",
       "      <td>1.31</td>\n",
       "      <td>1.29</td>\n",
       "      <td>1.14</td>\n",
       "      <td>140743.0</td>\n",
       "      <td>79614.0</td>\n",
       "      <td>61129.0</td>\n",
       "      <td>{\"x\": -122.90748349999996, \"y\": 47.04502490000...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>RingBuffer</td>\n",
       "      <td>esriMiles</td>\n",
       "      <td>esriMiles</td>\n",
       "      <td>5.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>148032.0</td>\n",
       "      <td>2696.0</td>\n",
       "      <td>51.4</td>\n",
       "      <td>61965.0</td>\n",
       "      <td>...</td>\n",
       "      <td>3451.0</td>\n",
       "      <td>359612.0</td>\n",
       "      <td>412573.0</td>\n",
       "      <td>1.42</td>\n",
       "      <td>1.37</td>\n",
       "      <td>1.26</td>\n",
       "      <td>162638.0</td>\n",
       "      <td>87230.0</td>\n",
       "      <td>75408.0</td>\n",
       "      <td>{\"x\": -122.87495999999999, \"y\": 47.04640310000...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2 rows × 27 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   has_data   area_type buffer_units buffer_unit  buffer_radii  \\\n",
       "0         1  RingBuffer    esriMiles   esriMiles           5.0   \n",
       "1         1  RingBuffer    esriMiles   esriMiles           5.0   \n",
       "\n",
       "                                  aggregation_method  keyusfacts_totpop_cy  \\\n",
       "0  BlockApportionment:US.BlockGroups;PointsLayer:...              121938.0   \n",
       "1  BlockApportionment:US.BlockGroups;PointsLayer:...              148032.0   \n",
       "\n",
       "   keyusfacts_gqpop_cy  keyusfacts_divindx_cy  keyusfacts_tothh_cy  ...  \\\n",
       "0               2969.0                   47.4              51980.0  ...   \n",
       "1               2696.0                   51.4              61965.0  ...   \n",
       "\n",
       "   keyusfacts_vacant_cy  keyusfacts_medval_cy  keyusfacts_avgval_cy  \\\n",
       "0                2798.0              370690.0              428025.0   \n",
       "1                3451.0              359612.0              412573.0   \n",
       "\n",
       "   keyusfacts_popgrw10cy  keyusfacts_hhgrw10cy  keyusfacts_famgrw10cy  \\\n",
       "0                   1.31                  1.29                   1.14   \n",
       "1                   1.42                  1.37                   1.26   \n",
       "\n",
       "   keyusfacts_dpop_cy  keyusfacts_dpopwrk_cy  keyusfacts_dpopres_cy  \\\n",
       "0            140743.0                79614.0                61129.0   \n",
       "1            162638.0                87230.0                75408.0   \n",
       "\n",
       "                                               SHAPE  \n",
       "0  {\"x\": -122.90748349999996, \"y\": 47.04502490000...  \n",
       "1  {\"x\": -122.87495999999999, \"y\": 47.04640310000...  \n",
       "\n",
       "[2 rows x 27 columns]"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pt3_enrich_df = usa_local.enrich(\n",
    "    geographies=geom_lst,\n",
    "    enrich_variables=kv,\n",
    "    proximity_value=5,\n",
    "    proximity_metric='miles'\n",
    ")\n",
    "\n",
    "pt3_enrich_df.info()\n",
    "pt3_enrich_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Specify Proximity Type\n",
    "\n",
    "The above examples all use the default `proximity_type` of `straight_line`. However, based on what transportation network you have available with the GIS source you are using, other methods are also available. These can be discovered using the `travel_modes` property of the `Country`. Any of the vaues in the `names` column are valid values for `proximity_type` in addition to the default `straight_line`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>name</th>\n",
       "      <th>alias</th>\n",
       "      <th>description</th>\n",
       "      <th>type</th>\n",
       "      <th>impedance</th>\n",
       "      <th>impedance_category</th>\n",
       "      <th>time_attribute_name</th>\n",
       "      <th>distance_attribute_name</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>driving_time</td>\n",
       "      <td>Driving Time</td>\n",
       "      <td>Models the movement of cars and other similar ...</td>\n",
       "      <td>AUTOMOBILE</td>\n",
       "      <td>TravelTime</td>\n",
       "      <td>temporal</td>\n",
       "      <td>TravelTime</td>\n",
       "      <td>Kilometers</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>driving_distance</td>\n",
       "      <td>Driving Distance</td>\n",
       "      <td>Models the movement of cars and other similar ...</td>\n",
       "      <td>AUTOMOBILE</td>\n",
       "      <td>Kilometers</td>\n",
       "      <td>distance</td>\n",
       "      <td>TravelTime</td>\n",
       "      <td>Kilometers</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>trucking_time</td>\n",
       "      <td>Trucking Time</td>\n",
       "      <td>Models basic truck travel by preferring design...</td>\n",
       "      <td>TRUCK</td>\n",
       "      <td>TruckTravelTime</td>\n",
       "      <td>temporal</td>\n",
       "      <td>TruckTravelTime</td>\n",
       "      <td>Kilometers</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>trucking_distance</td>\n",
       "      <td>Trucking Distance</td>\n",
       "      <td>Models basic truck travel by preferring design...</td>\n",
       "      <td>TRUCK</td>\n",
       "      <td>Kilometers</td>\n",
       "      <td>distance</td>\n",
       "      <td>TruckTravelTime</td>\n",
       "      <td>Kilometers</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>walking_time</td>\n",
       "      <td>Walking Time</td>\n",
       "      <td>Follows paths and roads that allow pedestrian ...</td>\n",
       "      <td>WALK</td>\n",
       "      <td>WalkTime</td>\n",
       "      <td>temporal</td>\n",
       "      <td>WalkTime</td>\n",
       "      <td>Kilometers</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>walking_distance</td>\n",
       "      <td>Walking Distance</td>\n",
       "      <td>Follows paths and roads that allow pedestrian ...</td>\n",
       "      <td>WALK</td>\n",
       "      <td>Kilometers</td>\n",
       "      <td>distance</td>\n",
       "      <td>WalkTime</td>\n",
       "      <td>Kilometers</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>rural_driving_time</td>\n",
       "      <td>Rural Driving Time</td>\n",
       "      <td>Models the movement of cars and other similar ...</td>\n",
       "      <td>AUTOMOBILE</td>\n",
       "      <td>TravelTime</td>\n",
       "      <td>temporal</td>\n",
       "      <td>TravelTime</td>\n",
       "      <td>Kilometers</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>rural_driving_distance</td>\n",
       "      <td>Rural Driving Distance</td>\n",
       "      <td>Models the movement of cars and other similar ...</td>\n",
       "      <td>AUTOMOBILE</td>\n",
       "      <td>Kilometers</td>\n",
       "      <td>distance</td>\n",
       "      <td>TravelTime</td>\n",
       "      <td>Kilometers</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                     name                   alias  \\\n",
       "0            driving_time            Driving Time   \n",
       "1        driving_distance        Driving Distance   \n",
       "2           trucking_time           Trucking Time   \n",
       "3       trucking_distance       Trucking Distance   \n",
       "4            walking_time            Walking Time   \n",
       "5        walking_distance        Walking Distance   \n",
       "6      rural_driving_time      Rural Driving Time   \n",
       "7  rural_driving_distance  Rural Driving Distance   \n",
       "\n",
       "                                         description        type  \\\n",
       "0  Models the movement of cars and other similar ...  AUTOMOBILE   \n",
       "1  Models the movement of cars and other similar ...  AUTOMOBILE   \n",
       "2  Models basic truck travel by preferring design...       TRUCK   \n",
       "3  Models basic truck travel by preferring design...       TRUCK   \n",
       "4  Follows paths and roads that allow pedestrian ...        WALK   \n",
       "5  Follows paths and roads that allow pedestrian ...        WALK   \n",
       "6  Models the movement of cars and other similar ...  AUTOMOBILE   \n",
       "7  Models the movement of cars and other similar ...  AUTOMOBILE   \n",
       "\n",
       "         impedance impedance_category time_attribute_name  \\\n",
       "0       TravelTime           temporal          TravelTime   \n",
       "1       Kilometers           distance          TravelTime   \n",
       "2  TruckTravelTime           temporal     TruckTravelTime   \n",
       "3       Kilometers           distance     TruckTravelTime   \n",
       "4         WalkTime           temporal            WalkTime   \n",
       "5       Kilometers           distance            WalkTime   \n",
       "6       TravelTime           temporal          TravelTime   \n",
       "7       Kilometers           distance          TravelTime   \n",
       "\n",
       "  distance_attribute_name  \n",
       "0              Kilometers  \n",
       "1              Kilometers  \n",
       "2              Kilometers  \n",
       "3              Kilometers  \n",
       "4              Kilometers  \n",
       "5              Kilometers  \n",
       "6              Kilometers  \n",
       "7              Kilometers  "
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "usa_local.travel_modes"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Hence, if we want to use both paved _and_ gravel roads (because gravel roads are _fun_), we can use `rural_driving_time`. Before selecting, we can investigate the details of the method by looking at the description."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'Models the movement of cars and other similar small automobiles, such as pickup trucks, and finds solutions that optimize travel distance. Travel obeys one-way roads, avoids illegal turns, and follows other rules that are specific to cars, but does not discourage travel on unpaved roads.'"
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "usa_local.travel_modes[usa_local.travel_modes.name == 'rural_driving_distance'].iloc[0]['description']"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "_Most_ people aren't going to be driving as fast on a gravel road as they are on an interstate. This enables us to take into consideration the differences in speed based on the road type. Using drive time as a method to define proximity around a location is a much better represenation of how people actually move around and interact with their surrouding environemnt...such as finding food at a grocery store."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 2 entries, 0 to 1\n",
      "Data columns (total 27 columns):\n",
      " #   Column                 Non-Null Count  Dtype   \n",
      "---  ------                 --------------  -----   \n",
      " 0   has_data               2 non-null      int64   \n",
      " 1   area_type              2 non-null      object  \n",
      " 2   buffer_units           2 non-null      object  \n",
      " 3   buffer_unit            2 non-null      object  \n",
      " 4   buffer_radii           2 non-null      float64 \n",
      " 5   aggregation_method     2 non-null      object  \n",
      " 6   keyusfacts_totpop_cy   2 non-null      float64 \n",
      " 7   keyusfacts_gqpop_cy    2 non-null      float64 \n",
      " 8   keyusfacts_divindx_cy  2 non-null      float64 \n",
      " 9   keyusfacts_tothh_cy    2 non-null      float64 \n",
      " 10  keyusfacts_avghhsz_cy  2 non-null      float64 \n",
      " 11  keyusfacts_medhinc_cy  2 non-null      float64 \n",
      " 12  keyusfacts_avghinc_cy  2 non-null      float64 \n",
      " 13  keyusfacts_pci_cy      2 non-null      float64 \n",
      " 14  keyusfacts_tothu_cy    2 non-null      float64 \n",
      " 15  keyusfacts_owner_cy    2 non-null      float64 \n",
      " 16  keyusfacts_renter_cy   2 non-null      float64 \n",
      " 17  keyusfacts_vacant_cy   2 non-null      float64 \n",
      " 18  keyusfacts_medval_cy   2 non-null      float64 \n",
      " 19  keyusfacts_avgval_cy   2 non-null      float64 \n",
      " 20  keyusfacts_popgrw10cy  2 non-null      float64 \n",
      " 21  keyusfacts_hhgrw10cy   2 non-null      float64 \n",
      " 22  keyusfacts_famgrw10cy  2 non-null      float64 \n",
      " 23  keyusfacts_dpop_cy     2 non-null      float64 \n",
      " 24  keyusfacts_dpopwrk_cy  2 non-null      float64 \n",
      " 25  keyusfacts_dpopres_cy  2 non-null      float64 \n",
      " 26  SHAPE                  2 non-null      geometry\n",
      "dtypes: float64(21), geometry(1), int64(1), object(4)\n",
      "memory usage: 560.0+ bytes\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>has_data</th>\n",
       "      <th>area_type</th>\n",
       "      <th>buffer_units</th>\n",
       "      <th>buffer_unit</th>\n",
       "      <th>buffer_radii</th>\n",
       "      <th>aggregation_method</th>\n",
       "      <th>keyusfacts_totpop_cy</th>\n",
       "      <th>keyusfacts_gqpop_cy</th>\n",
       "      <th>keyusfacts_divindx_cy</th>\n",
       "      <th>keyusfacts_tothh_cy</th>\n",
       "      <th>...</th>\n",
       "      <th>keyusfacts_vacant_cy</th>\n",
       "      <th>keyusfacts_medval_cy</th>\n",
       "      <th>keyusfacts_avgval_cy</th>\n",
       "      <th>keyusfacts_popgrw10cy</th>\n",
       "      <th>keyusfacts_hhgrw10cy</th>\n",
       "      <th>keyusfacts_famgrw10cy</th>\n",
       "      <th>keyusfacts_dpop_cy</th>\n",
       "      <th>keyusfacts_dpopwrk_cy</th>\n",
       "      <th>keyusfacts_dpopres_cy</th>\n",
       "      <th>SHAPE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>Rural Driving Time</td>\n",
       "      <td>Minutes</td>\n",
       "      <td>Minutes</td>\n",
       "      <td>12.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>89167.0</td>\n",
       "      <td>2085.0</td>\n",
       "      <td>47.4</td>\n",
       "      <td>39012.0</td>\n",
       "      <td>...</td>\n",
       "      <td>2045.0</td>\n",
       "      <td>370989.0</td>\n",
       "      <td>423914.0</td>\n",
       "      <td>1.38</td>\n",
       "      <td>1.36</td>\n",
       "      <td>1.2</td>\n",
       "      <td>113049.0</td>\n",
       "      <td>68827.0</td>\n",
       "      <td>44222.0</td>\n",
       "      <td>{\"x\": -122.90748349999996, \"y\": 47.04502490000...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>Rural Driving Time</td>\n",
       "      <td>Minutes</td>\n",
       "      <td>Minutes</td>\n",
       "      <td>12.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>125186.0</td>\n",
       "      <td>2604.0</td>\n",
       "      <td>52.1</td>\n",
       "      <td>53293.0</td>\n",
       "      <td>...</td>\n",
       "      <td>3074.0</td>\n",
       "      <td>359599.0</td>\n",
       "      <td>403034.0</td>\n",
       "      <td>1.43</td>\n",
       "      <td>1.41</td>\n",
       "      <td>1.3</td>\n",
       "      <td>144557.0</td>\n",
       "      <td>81408.0</td>\n",
       "      <td>63149.0</td>\n",
       "      <td>{\"x\": -122.87495999999999, \"y\": 47.04640310000...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2 rows × 27 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   has_data           area_type buffer_units buffer_unit  buffer_radii  \\\n",
       "0         1  Rural Driving Time      Minutes     Minutes          12.0   \n",
       "1         1  Rural Driving Time      Minutes     Minutes          12.0   \n",
       "\n",
       "                                  aggregation_method  keyusfacts_totpop_cy  \\\n",
       "0  BlockApportionment:US.BlockGroups;PointsLayer:...               89167.0   \n",
       "1  BlockApportionment:US.BlockGroups;PointsLayer:...              125186.0   \n",
       "\n",
       "   keyusfacts_gqpop_cy  keyusfacts_divindx_cy  keyusfacts_tothh_cy  ...  \\\n",
       "0               2085.0                   47.4              39012.0  ...   \n",
       "1               2604.0                   52.1              53293.0  ...   \n",
       "\n",
       "   keyusfacts_vacant_cy  keyusfacts_medval_cy  keyusfacts_avgval_cy  \\\n",
       "0                2045.0              370989.0              423914.0   \n",
       "1                3074.0              359599.0              403034.0   \n",
       "\n",
       "   keyusfacts_popgrw10cy  keyusfacts_hhgrw10cy  keyusfacts_famgrw10cy  \\\n",
       "0                   1.38                  1.36                    1.2   \n",
       "1                   1.43                  1.41                    1.3   \n",
       "\n",
       "   keyusfacts_dpop_cy  keyusfacts_dpopwrk_cy  keyusfacts_dpopres_cy  \\\n",
       "0            113049.0                68827.0                44222.0   \n",
       "1            144557.0                81408.0                63149.0   \n",
       "\n",
       "                                               SHAPE  \n",
       "0  {\"x\": -122.90748349999996, \"y\": 47.04502490000...  \n",
       "1  {\"x\": -122.87495999999999, \"y\": 47.04640310000...  \n",
       "\n",
       "[2 rows x 27 columns]"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pt4_enrich_df = usa_local.enrich(\n",
    "    geographies=geom_lst,\n",
    "    enrich_variables=kv,\n",
    "    proximity_type='rural_driving_time',\n",
    "    proximity_value=12,\n",
    "    proximity_metric='minutes'\n",
    ")\n",
    "\n",
    "pt4_enrich_df.info()\n",
    "pt4_enrich_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Use a Spatially Enabled Data Frame\n",
    "\n",
    "Finally, although using a list of `Geometry` objects may be useful, likely a much more common paradigm is the Spatially Enabled Data Frame. Above, we created a Spatially Enabled Data Frame. We can use this as input into the `geographies` parameter.\n",
    "\n",
    "Also, just to demonstrate the interchangability of GIS sources, we are going to create a `Country` instance using the connection to ArcGIS Online, and perform the same workflow."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 2 entries, 0 to 1\n",
      "Data columns (total 27 columns):\n",
      " #   Column                 Non-Null Count  Dtype   \n",
      "---  ------                 --------------  -----   \n",
      " 0   has_data               2 non-null      int64   \n",
      " 1   area_type              2 non-null      object  \n",
      " 2   buffer_units           2 non-null      object  \n",
      " 3   buffer_unit            2 non-null      object  \n",
      " 4   buffer_radii           2 non-null      float64 \n",
      " 5   aggregation_method     2 non-null      object  \n",
      " 6   keyusfacts_totpop_cy   2 non-null      float64 \n",
      " 7   keyusfacts_gqpop_cy    2 non-null      float64 \n",
      " 8   keyusfacts_divindx_cy  2 non-null      float64 \n",
      " 9   keyusfacts_tothh_cy    2 non-null      float64 \n",
      " 10  keyusfacts_avghhsz_cy  2 non-null      float64 \n",
      " 11  keyusfacts_medhinc_cy  2 non-null      float64 \n",
      " 12  keyusfacts_avghinc_cy  2 non-null      float64 \n",
      " 13  keyusfacts_pci_cy      2 non-null      float64 \n",
      " 14  keyusfacts_tothu_cy    2 non-null      float64 \n",
      " 15  keyusfacts_owner_cy    2 non-null      float64 \n",
      " 16  keyusfacts_renter_cy   2 non-null      float64 \n",
      " 17  keyusfacts_vacant_cy   2 non-null      float64 \n",
      " 18  keyusfacts_medval_cy   2 non-null      float64 \n",
      " 19  keyusfacts_avgval_cy   2 non-null      float64 \n",
      " 20  keyusfacts_popgrw10cy  2 non-null      float64 \n",
      " 21  keyusfacts_hhgrw10cy   2 non-null      float64 \n",
      " 22  keyusfacts_famgrw10cy  2 non-null      float64 \n",
      " 23  keyusfacts_dpop_cy     2 non-null      float64 \n",
      " 24  keyusfacts_dpopwrk_cy  2 non-null      float64 \n",
      " 25  keyusfacts_dpopres_cy  2 non-null      float64 \n",
      " 26  SHAPE                  2 non-null      geometry\n",
      "dtypes: float64(21), geometry(1), int64(1), object(4)\n",
      "memory usage: 560.0+ bytes\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>has_data</th>\n",
       "      <th>area_type</th>\n",
       "      <th>buffer_units</th>\n",
       "      <th>buffer_unit</th>\n",
       "      <th>buffer_radii</th>\n",
       "      <th>aggregation_method</th>\n",
       "      <th>keyusfacts_totpop_cy</th>\n",
       "      <th>keyusfacts_gqpop_cy</th>\n",
       "      <th>keyusfacts_divindx_cy</th>\n",
       "      <th>keyusfacts_tothh_cy</th>\n",
       "      <th>...</th>\n",
       "      <th>keyusfacts_vacant_cy</th>\n",
       "      <th>keyusfacts_medval_cy</th>\n",
       "      <th>keyusfacts_avgval_cy</th>\n",
       "      <th>keyusfacts_popgrw10cy</th>\n",
       "      <th>keyusfacts_hhgrw10cy</th>\n",
       "      <th>keyusfacts_famgrw10cy</th>\n",
       "      <th>keyusfacts_dpop_cy</th>\n",
       "      <th>keyusfacts_dpopwrk_cy</th>\n",
       "      <th>keyusfacts_dpopres_cy</th>\n",
       "      <th>SHAPE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>Rural Driving Time</td>\n",
       "      <td>Minutes</td>\n",
       "      <td>Minutes</td>\n",
       "      <td>12.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>89167.0</td>\n",
       "      <td>2085.0</td>\n",
       "      <td>47.4</td>\n",
       "      <td>39012.0</td>\n",
       "      <td>...</td>\n",
       "      <td>2045.0</td>\n",
       "      <td>370989.0</td>\n",
       "      <td>423914.0</td>\n",
       "      <td>1.38</td>\n",
       "      <td>1.36</td>\n",
       "      <td>1.2</td>\n",
       "      <td>113049.0</td>\n",
       "      <td>68827.0</td>\n",
       "      <td>44222.0</td>\n",
       "      <td>{\"x\": -122.90748349999996, \"y\": 47.04502490000...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>Rural Driving Time</td>\n",
       "      <td>Minutes</td>\n",
       "      <td>Minutes</td>\n",
       "      <td>12.0</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>125186.0</td>\n",
       "      <td>2604.0</td>\n",
       "      <td>52.1</td>\n",
       "      <td>53293.0</td>\n",
       "      <td>...</td>\n",
       "      <td>3074.0</td>\n",
       "      <td>359599.0</td>\n",
       "      <td>403034.0</td>\n",
       "      <td>1.43</td>\n",
       "      <td>1.41</td>\n",
       "      <td>1.3</td>\n",
       "      <td>144557.0</td>\n",
       "      <td>81408.0</td>\n",
       "      <td>63149.0</td>\n",
       "      <td>{\"x\": -122.87495999999999, \"y\": 47.04640310000...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2 rows × 27 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   has_data           area_type buffer_units buffer_unit  buffer_radii  \\\n",
       "0         1  Rural Driving Time      Minutes     Minutes          12.0   \n",
       "1         1  Rural Driving Time      Minutes     Minutes          12.0   \n",
       "\n",
       "                                  aggregation_method  keyusfacts_totpop_cy  \\\n",
       "0  BlockApportionment:US.BlockGroups;PointsLayer:...               89167.0   \n",
       "1  BlockApportionment:US.BlockGroups;PointsLayer:...              125186.0   \n",
       "\n",
       "   keyusfacts_gqpop_cy  keyusfacts_divindx_cy  keyusfacts_tothh_cy  ...  \\\n",
       "0               2085.0                   47.4              39012.0  ...   \n",
       "1               2604.0                   52.1              53293.0  ...   \n",
       "\n",
       "   keyusfacts_vacant_cy  keyusfacts_medval_cy  keyusfacts_avgval_cy  \\\n",
       "0                2045.0              370989.0              423914.0   \n",
       "1                3074.0              359599.0              403034.0   \n",
       "\n",
       "   keyusfacts_popgrw10cy  keyusfacts_hhgrw10cy  keyusfacts_famgrw10cy  \\\n",
       "0                   1.38                  1.36                    1.2   \n",
       "1                   1.43                  1.41                    1.3   \n",
       "\n",
       "   keyusfacts_dpop_cy  keyusfacts_dpopwrk_cy  keyusfacts_dpopres_cy  \\\n",
       "0            113049.0                68827.0                44222.0   \n",
       "1            144557.0                81408.0                63149.0   \n",
       "\n",
       "                                               SHAPE  \n",
       "0  {\"x\": -122.90748349999996, \"y\": 47.04502490000...  \n",
       "1  {\"x\": -122.87495999999999, \"y\": 47.04640310000...  \n",
       "\n",
       "[2 rows x 27 columns]"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# create country\n",
    "usa_gis = Country('usa', gis=gis_agol)\n",
    "\n",
    "# select variables\n",
    "ev = usa_gis.enrich_variables\n",
    "kv = ev[\n",
    "    (ev.data_collection.str.lower().str.contains('key'))\n",
    "    & (ev.name.str.lower().str.endswith('cy'))\n",
    "].reset_index(drop=True)\n",
    "\n",
    "# perform enrichment\n",
    "pt5_enrich_df = usa_gis.enrich(\n",
    "    geographies=geom_lst,\n",
    "    enrich_variables=kv,\n",
    "    proximity_type='rural_driving_time',\n",
    "    proximity_value=12,\n",
    "    proximity_metric='minutes'\n",
    ")\n",
    "\n",
    "pt5_enrich_df.info()\n",
    "pt5_enrich_df.head()"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.11"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
