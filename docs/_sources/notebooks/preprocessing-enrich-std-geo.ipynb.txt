{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Enrich Using Standard Geographies"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Starting off, we import a few required Python resources. While there are quite a few in there, the import of note is `from arcgis.geoenrichment import Country, get_countries`. We are going to use this object and method to discover and perform our analysis."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "from pathlib import Path\n",
    "\n",
    "from arcgis.features import GeoAccessor\n",
    "from arcgis.geoenrichment import Country\n",
    "from arcgis.gis import GIS\n",
    "import pandas as pd\n",
    "from sklearn.pipeline import make_pipeline"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next, we need some test data to work with. Hence, here we are accessing two files with pickled exports from Spatially Enabled Pandas Data Frames. One is of postal codes (zip codes) in Portland, Oregon, and the other is for block groups in Portland."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "# paths to input data\n",
    "dir_prj = Path.cwd().parent\n",
    "dir_data = dir_prj/'data'\n",
    "dir_raw = dir_data/'raw'\n",
    "\n",
    "# import the two preprocessors from the examples\n",
    "sys.path.append(str(dir_prj/'src'))\n",
    "from ba_samples.preprocessing import EnrichStandardGeography, KeepOnlyEnrichColumns\n",
    "\n",
    "# specifically, the data being used for this example - pickled dataframes\n",
    "postal_codes_pth = dir_raw/'postal_codes.pkl'\n",
    "block_groups_pth = dir_raw/'block_groups.pkl'"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "For the first example, we are going to get a list of standard geography codes to use from the postal code data, just a list of zip codes."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "['83801', '83803', '83810', '83814', '83815', '83833', '83835', '83842', '83854', '83858', '83861', '83869', '83876']\n"
     ]
    }
   ],
   "source": [
    "postal_code_df = pd.read_pickle(postal_codes_pth)\n",
    "postal_code_lst = list(postal_code_df['ID'])\n",
    "\n",
    "print(postal_code_lst)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "For the latter, we are going to use the Data Frame directly, and tell the `enrich` function which column to look in when we invoke the function."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 66 entries, 0 to 65\n",
      "Data columns (total 3 columns):\n",
      " #   Column   Non-Null Count  Dtype \n",
      "---  ------   --------------  ----- \n",
      " 0   ID       66 non-null     object\n",
      " 1   NAME     66 non-null     object\n",
      " 2   IDField  66 non-null     object\n",
      "dtypes: object(3)\n",
      "memory usage: 1.7+ KB\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>ID</th>\n",
       "      <th>NAME</th>\n",
       "      <th>IDField</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>160550001001</td>\n",
       "      <td>160550001.001</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>160550003011</td>\n",
       "      <td>160550003.011</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>160550003012</td>\n",
       "      <td>160550003.012</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>160550003021</td>\n",
       "      <td>160550003.021</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>160550004011</td>\n",
       "      <td>160550004.011</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "             ID           NAME IDField\n",
       "0  160550001001  160550001.001   17660\n",
       "1  160550003011  160550003.011   17660\n",
       "2  160550003012  160550003.012   17660\n",
       "3  160550003021  160550003.021   17660\n",
       "4  160550004011  160550004.011   17660"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "block_groups_df = pd.read_pickle(block_groups_pth)\n",
    "\n",
    "block_groups_df.info()\n",
    "block_groups_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now, we are going to need a connection to ArcGIS Online to demonstrate the abiliy to use ArcGIS Online for geoenrichment. This is accomplished by instantiating a `GIS` object instance with valid credentials read from environment variables."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "gis_local = GIS('pro')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Standard Geography From a List"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "To enrich, we start by creating a `Country` object instance. As part of the constructor, we need to tell the object what Business Analyst source to use in the `gis` parameter. In this case, we are telling the object to use ArcGIS Pro with Business Analyst and local data for the United States."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<Country - United States 2021 ('local')>"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "usa_local = Country('usa', gis=gis_local)\n",
    "\n",
    "usa_local"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next, we need to get some enrich variables to use. We can discover what is available using the `enrich_variables` property of the country object to retrieve a Pandas Data Frame of variables available for the country. From these tens of thousands of variables, we can prune this down to a manageable subset."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>name</th>\n",
       "      <th>alias</th>\n",
       "      <th>data_collection</th>\n",
       "      <th>enrich_name</th>\n",
       "      <th>enrich_field_name</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>TOTPOP_CY</td>\n",
       "      <td>2021 Total Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.TOTPOP_CY</td>\n",
       "      <td>KeyUSFacts_TOTPOP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>GQPOP_CY</td>\n",
       "      <td>2021 Group Quarters Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.GQPOP_CY</td>\n",
       "      <td>KeyUSFacts_GQPOP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>DIVINDX_CY</td>\n",
       "      <td>2021 Diversity Index</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DIVINDX_CY</td>\n",
       "      <td>KeyUSFacts_DIVINDX_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>TOTHH_CY</td>\n",
       "      <td>2021 Total Households</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.TOTHH_CY</td>\n",
       "      <td>KeyUSFacts_TOTHH_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>AVGHHSZ_CY</td>\n",
       "      <td>2021 Average Household Size</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.AVGHHSZ_CY</td>\n",
       "      <td>KeyUSFacts_AVGHHSZ_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>MEDHINC_CY</td>\n",
       "      <td>2021 Median Household Income</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.MEDHINC_CY</td>\n",
       "      <td>KeyUSFacts_MEDHINC_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>AVGHINC_CY</td>\n",
       "      <td>2021 Average Household Income</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.AVGHINC_CY</td>\n",
       "      <td>KeyUSFacts_AVGHINC_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>PCI_CY</td>\n",
       "      <td>2021 Per Capita Income</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.PCI_CY</td>\n",
       "      <td>KeyUSFacts_PCI_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>TOTHU_CY</td>\n",
       "      <td>2021 Total Housing Units</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.TOTHU_CY</td>\n",
       "      <td>KeyUSFacts_TOTHU_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>OWNER_CY</td>\n",
       "      <td>2021 Owner Occupied HUs</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.OWNER_CY</td>\n",
       "      <td>KeyUSFacts_OWNER_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>RENTER_CY</td>\n",
       "      <td>2021 Renter Occupied HUs</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.RENTER_CY</td>\n",
       "      <td>KeyUSFacts_RENTER_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>VACANT_CY</td>\n",
       "      <td>2021 Vacant Housing Units</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.VACANT_CY</td>\n",
       "      <td>KeyUSFacts_VACANT_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>MEDVAL_CY</td>\n",
       "      <td>2021 Median Home Value</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.MEDVAL_CY</td>\n",
       "      <td>KeyUSFacts_MEDVAL_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>AVGVAL_CY</td>\n",
       "      <td>2021 Average Home Value</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.AVGVAL_CY</td>\n",
       "      <td>KeyUSFacts_AVGVAL_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>POPGRW10CY</td>\n",
       "      <td>2010-2021 Growth Rate: Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.POPGRW10CY</td>\n",
       "      <td>KeyUSFacts_POPGRW10CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>HHGRW10CY</td>\n",
       "      <td>2010-2021 Growth Rate: Households</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.HHGRW10CY</td>\n",
       "      <td>KeyUSFacts_HHGRW10CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>FAMGRW10CY</td>\n",
       "      <td>2010-2021 Growth Rate: Families</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.FAMGRW10CY</td>\n",
       "      <td>KeyUSFacts_FAMGRW10CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>DPOP_CY</td>\n",
       "      <td>2021 Total Daytime Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DPOP_CY</td>\n",
       "      <td>KeyUSFacts_DPOP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>DPOPWRK_CY</td>\n",
       "      <td>2021 Daytime Pop: Workers</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DPOPWRK_CY</td>\n",
       "      <td>KeyUSFacts_DPOPWRK_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>DPOPRES_CY</td>\n",
       "      <td>2021 Daytime Pop: Residents</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DPOPRES_CY</td>\n",
       "      <td>KeyUSFacts_DPOPRES_CY</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          name                              alias data_collection  \\\n",
       "0    TOTPOP_CY              2021 Total Population      KeyUSFacts   \n",
       "1     GQPOP_CY     2021 Group Quarters Population      KeyUSFacts   \n",
       "2   DIVINDX_CY               2021 Diversity Index      KeyUSFacts   \n",
       "3     TOTHH_CY              2021 Total Households      KeyUSFacts   \n",
       "4   AVGHHSZ_CY        2021 Average Household Size      KeyUSFacts   \n",
       "5   MEDHINC_CY       2021 Median Household Income      KeyUSFacts   \n",
       "6   AVGHINC_CY      2021 Average Household Income      KeyUSFacts   \n",
       "7       PCI_CY             2021 Per Capita Income      KeyUSFacts   \n",
       "8     TOTHU_CY           2021 Total Housing Units      KeyUSFacts   \n",
       "9     OWNER_CY            2021 Owner Occupied HUs      KeyUSFacts   \n",
       "10   RENTER_CY           2021 Renter Occupied HUs      KeyUSFacts   \n",
       "11   VACANT_CY          2021 Vacant Housing Units      KeyUSFacts   \n",
       "12   MEDVAL_CY             2021 Median Home Value      KeyUSFacts   \n",
       "13   AVGVAL_CY            2021 Average Home Value      KeyUSFacts   \n",
       "14  POPGRW10CY  2010-2021 Growth Rate: Population      KeyUSFacts   \n",
       "15   HHGRW10CY  2010-2021 Growth Rate: Households      KeyUSFacts   \n",
       "16  FAMGRW10CY    2010-2021 Growth Rate: Families      KeyUSFacts   \n",
       "17     DPOP_CY      2021 Total Daytime Population      KeyUSFacts   \n",
       "18  DPOPWRK_CY          2021 Daytime Pop: Workers      KeyUSFacts   \n",
       "19  DPOPRES_CY        2021 Daytime Pop: Residents      KeyUSFacts   \n",
       "\n",
       "              enrich_name      enrich_field_name  \n",
       "0    KeyUSFacts.TOTPOP_CY   KeyUSFacts_TOTPOP_CY  \n",
       "1     KeyUSFacts.GQPOP_CY    KeyUSFacts_GQPOP_CY  \n",
       "2   KeyUSFacts.DIVINDX_CY  KeyUSFacts_DIVINDX_CY  \n",
       "3     KeyUSFacts.TOTHH_CY    KeyUSFacts_TOTHH_CY  \n",
       "4   KeyUSFacts.AVGHHSZ_CY  KeyUSFacts_AVGHHSZ_CY  \n",
       "5   KeyUSFacts.MEDHINC_CY  KeyUSFacts_MEDHINC_CY  \n",
       "6   KeyUSFacts.AVGHINC_CY  KeyUSFacts_AVGHINC_CY  \n",
       "7       KeyUSFacts.PCI_CY      KeyUSFacts_PCI_CY  \n",
       "8     KeyUSFacts.TOTHU_CY    KeyUSFacts_TOTHU_CY  \n",
       "9     KeyUSFacts.OWNER_CY    KeyUSFacts_OWNER_CY  \n",
       "10   KeyUSFacts.RENTER_CY   KeyUSFacts_RENTER_CY  \n",
       "11   KeyUSFacts.VACANT_CY   KeyUSFacts_VACANT_CY  \n",
       "12   KeyUSFacts.MEDVAL_CY   KeyUSFacts_MEDVAL_CY  \n",
       "13   KeyUSFacts.AVGVAL_CY   KeyUSFacts_AVGVAL_CY  \n",
       "14  KeyUSFacts.POPGRW10CY  KeyUSFacts_POPGRW10CY  \n",
       "15   KeyUSFacts.HHGRW10CY   KeyUSFacts_HHGRW10CY  \n",
       "16  KeyUSFacts.FAMGRW10CY  KeyUSFacts_FAMGRW10CY  \n",
       "17     KeyUSFacts.DPOP_CY     KeyUSFacts_DPOP_CY  \n",
       "18  KeyUSFacts.DPOPWRK_CY  KeyUSFacts_DPOPWRK_CY  \n",
       "19  KeyUSFacts.DPOPRES_CY  KeyUSFacts_DPOPRES_CY  "
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ev = usa_local.enrich_variables\n",
    "kv = ev[\n",
    "    (ev.data_collection.str.lower().str.contains('key'))\n",
    "    & (ev.name.str.lower().str.endswith('cy'))\n",
    "].reset_index(drop=True)\n",
    "\n",
    "kv"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Finally, we are ready to enrich the postal codes using the resources above."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "Index: 13 entries, 83801 to 83876\n",
      "Data columns (total 20 columns):\n",
      " #   Column                 Non-Null Count  Dtype  \n",
      "---  ------                 --------------  -----  \n",
      " 0   keyusfacts_totpop_cy   13 non-null     float64\n",
      " 1   keyusfacts_gqpop_cy    13 non-null     float64\n",
      " 2   keyusfacts_divindx_cy  13 non-null     float64\n",
      " 3   keyusfacts_tothh_cy    13 non-null     float64\n",
      " 4   keyusfacts_avghhsz_cy  13 non-null     float64\n",
      " 5   keyusfacts_medhinc_cy  13 non-null     float64\n",
      " 6   keyusfacts_avghinc_cy  13 non-null     float64\n",
      " 7   keyusfacts_pci_cy      13 non-null     float64\n",
      " 8   keyusfacts_tothu_cy    13 non-null     float64\n",
      " 9   keyusfacts_owner_cy    13 non-null     float64\n",
      " 10  keyusfacts_renter_cy   13 non-null     float64\n",
      " 11  keyusfacts_vacant_cy   13 non-null     float64\n",
      " 12  keyusfacts_medval_cy   13 non-null     float64\n",
      " 13  keyusfacts_avgval_cy   13 non-null     float64\n",
      " 14  keyusfacts_popgrw10cy  13 non-null     float64\n",
      " 15  keyusfacts_hhgrw10cy   13 non-null     float64\n",
      " 16  keyusfacts_famgrw10cy  13 non-null     float64\n",
      " 17  keyusfacts_dpop_cy     13 non-null     float64\n",
      " 18  keyusfacts_dpopwrk_cy  13 non-null     float64\n",
      " 19  keyusfacts_dpopres_cy  13 non-null     float64\n",
      "dtypes: float64(20)\n",
      "memory usage: 2.1+ KB\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>keyusfacts_totpop_cy</th>\n",
       "      <th>keyusfacts_gqpop_cy</th>\n",
       "      <th>keyusfacts_divindx_cy</th>\n",
       "      <th>keyusfacts_tothh_cy</th>\n",
       "      <th>keyusfacts_avghhsz_cy</th>\n",
       "      <th>keyusfacts_medhinc_cy</th>\n",
       "      <th>keyusfacts_avghinc_cy</th>\n",
       "      <th>keyusfacts_pci_cy</th>\n",
       "      <th>keyusfacts_tothu_cy</th>\n",
       "      <th>keyusfacts_owner_cy</th>\n",
       "      <th>keyusfacts_renter_cy</th>\n",
       "      <th>keyusfacts_vacant_cy</th>\n",
       "      <th>keyusfacts_medval_cy</th>\n",
       "      <th>keyusfacts_avgval_cy</th>\n",
       "      <th>keyusfacts_popgrw10cy</th>\n",
       "      <th>keyusfacts_hhgrw10cy</th>\n",
       "      <th>keyusfacts_famgrw10cy</th>\n",
       "      <th>keyusfacts_dpop_cy</th>\n",
       "      <th>keyusfacts_dpopwrk_cy</th>\n",
       "      <th>keyusfacts_dpopres_cy</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>id_field</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>83801</th>\n",
       "      <td>8497.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>13.6</td>\n",
       "      <td>3142.0</td>\n",
       "      <td>2.70</td>\n",
       "      <td>62413.0</td>\n",
       "      <td>78746.0</td>\n",
       "      <td>30156.0</td>\n",
       "      <td>3563.0</td>\n",
       "      <td>2660.0</td>\n",
       "      <td>482.0</td>\n",
       "      <td>421.0</td>\n",
       "      <td>382542.0</td>\n",
       "      <td>391184.0</td>\n",
       "      <td>2.07</td>\n",
       "      <td>2.09</td>\n",
       "      <td>1.92</td>\n",
       "      <td>6502.0</td>\n",
       "      <td>1962.0</td>\n",
       "      <td>4540.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>83803</th>\n",
       "      <td>656.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>10.5</td>\n",
       "      <td>341.0</td>\n",
       "      <td>1.92</td>\n",
       "      <td>43344.0</td>\n",
       "      <td>61732.0</td>\n",
       "      <td>29472.0</td>\n",
       "      <td>659.0</td>\n",
       "      <td>264.0</td>\n",
       "      <td>76.0</td>\n",
       "      <td>318.0</td>\n",
       "      <td>391333.0</td>\n",
       "      <td>403113.0</td>\n",
       "      <td>1.76</td>\n",
       "      <td>1.80</td>\n",
       "      <td>1.56</td>\n",
       "      <td>499.0</td>\n",
       "      <td>145.0</td>\n",
       "      <td>354.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>83810</th>\n",
       "      <td>1090.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>11.7</td>\n",
       "      <td>479.0</td>\n",
       "      <td>2.27</td>\n",
       "      <td>60088.0</td>\n",
       "      <td>89006.0</td>\n",
       "      <td>38340.0</td>\n",
       "      <td>579.0</td>\n",
       "      <td>406.0</td>\n",
       "      <td>72.0</td>\n",
       "      <td>100.0</td>\n",
       "      <td>437903.0</td>\n",
       "      <td>464383.0</td>\n",
       "      <td>0.94</td>\n",
       "      <td>0.96</td>\n",
       "      <td>0.76</td>\n",
       "      <td>762.0</td>\n",
       "      <td>246.0</td>\n",
       "      <td>516.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>83814</th>\n",
       "      <td>28546.0</td>\n",
       "      <td>609.0</td>\n",
       "      <td>21.2</td>\n",
       "      <td>12454.0</td>\n",
       "      <td>2.24</td>\n",
       "      <td>57487.0</td>\n",
       "      <td>80524.0</td>\n",
       "      <td>34960.0</td>\n",
       "      <td>15054.0</td>\n",
       "      <td>6855.0</td>\n",
       "      <td>5599.0</td>\n",
       "      <td>2600.0</td>\n",
       "      <td>377722.0</td>\n",
       "      <td>508589.0</td>\n",
       "      <td>1.86</td>\n",
       "      <td>1.91</td>\n",
       "      <td>1.72</td>\n",
       "      <td>38178.0</td>\n",
       "      <td>23011.0</td>\n",
       "      <td>15167.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>83815</th>\n",
       "      <td>38614.0</td>\n",
       "      <td>617.0</td>\n",
       "      <td>24.1</td>\n",
       "      <td>15247.0</td>\n",
       "      <td>2.49</td>\n",
       "      <td>56872.0</td>\n",
       "      <td>73431.0</td>\n",
       "      <td>29323.0</td>\n",
       "      <td>16393.0</td>\n",
       "      <td>9649.0</td>\n",
       "      <td>5598.0</td>\n",
       "      <td>1146.0</td>\n",
       "      <td>308198.0</td>\n",
       "      <td>374194.0</td>\n",
       "      <td>1.79</td>\n",
       "      <td>1.78</td>\n",
       "      <td>1.51</td>\n",
       "      <td>37345.0</td>\n",
       "      <td>15891.0</td>\n",
       "      <td>21454.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          keyusfacts_totpop_cy  keyusfacts_gqpop_cy  keyusfacts_divindx_cy  \\\n",
       "id_field                                                                     \n",
       "83801                   8497.0                  0.0                   13.6   \n",
       "83803                    656.0                  0.0                   10.5   \n",
       "83810                   1090.0                  4.0                   11.7   \n",
       "83814                  28546.0                609.0                   21.2   \n",
       "83815                  38614.0                617.0                   24.1   \n",
       "\n",
       "          keyusfacts_tothh_cy  keyusfacts_avghhsz_cy  keyusfacts_medhinc_cy  \\\n",
       "id_field                                                                      \n",
       "83801                  3142.0                   2.70                62413.0   \n",
       "83803                   341.0                   1.92                43344.0   \n",
       "83810                   479.0                   2.27                60088.0   \n",
       "83814                 12454.0                   2.24                57487.0   \n",
       "83815                 15247.0                   2.49                56872.0   \n",
       "\n",
       "          keyusfacts_avghinc_cy  keyusfacts_pci_cy  keyusfacts_tothu_cy  \\\n",
       "id_field                                                                  \n",
       "83801                   78746.0            30156.0               3563.0   \n",
       "83803                   61732.0            29472.0                659.0   \n",
       "83810                   89006.0            38340.0                579.0   \n",
       "83814                   80524.0            34960.0              15054.0   \n",
       "83815                   73431.0            29323.0              16393.0   \n",
       "\n",
       "          keyusfacts_owner_cy  keyusfacts_renter_cy  keyusfacts_vacant_cy  \\\n",
       "id_field                                                                    \n",
       "83801                  2660.0                 482.0                 421.0   \n",
       "83803                   264.0                  76.0                 318.0   \n",
       "83810                   406.0                  72.0                 100.0   \n",
       "83814                  6855.0                5599.0                2600.0   \n",
       "83815                  9649.0                5598.0                1146.0   \n",
       "\n",
       "          keyusfacts_medval_cy  keyusfacts_avgval_cy  keyusfacts_popgrw10cy  \\\n",
       "id_field                                                                      \n",
       "83801                 382542.0              391184.0                   2.07   \n",
       "83803                 391333.0              403113.0                   1.76   \n",
       "83810                 437903.0              464383.0                   0.94   \n",
       "83814                 377722.0              508589.0                   1.86   \n",
       "83815                 308198.0              374194.0                   1.79   \n",
       "\n",
       "          keyusfacts_hhgrw10cy  keyusfacts_famgrw10cy  keyusfacts_dpop_cy  \\\n",
       "id_field                                                                    \n",
       "83801                     2.09                   1.92              6502.0   \n",
       "83803                     1.80                   1.56               499.0   \n",
       "83810                     0.96                   0.76               762.0   \n",
       "83814                     1.91                   1.72             38178.0   \n",
       "83815                     1.78                   1.51             37345.0   \n",
       "\n",
       "          keyusfacts_dpopwrk_cy  keyusfacts_dpopres_cy  \n",
       "id_field                                                \n",
       "83801                    1962.0                 4540.0  \n",
       "83803                     145.0                  354.0  \n",
       "83810                     246.0                  516.0  \n",
       "83814                   23011.0                15167.0  \n",
       "83815                   15891.0                21454.0  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pipe = make_pipeline(\n",
    "    EnrichStandardGeography(usa_local, enrich_variables=kv, standard_geography_level='zip5', return_geometry=False),\n",
    "    KeepOnlyEnrichColumns(usa_local, id_column='id_field', keep_geometry=False)\n",
    ")\n",
    "\n",
    "trn_df = pipe.fit_transform(postal_code_lst)\n",
    "\n",
    "trn_df.info()\n",
    "trn_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "metadata": {},
   "outputs": [
    {
     "ename": "NameError",
     "evalue": "name 'check_is_fitted' is not defined",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mNameError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[1;32m~\\AppData\\Local\\Temp/ipykernel_11676/455125397.py\u001b[0m in \u001b[0;36m<module>\u001b[1;34m\u001b[0m\n\u001b[0;32m     25\u001b[0m \u001b[0mss\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mPowerTransformer\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m     26\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m---> 27\u001b[1;33m \u001b[0mres\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mss\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mtransform\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mtrn_df\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m     28\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m     29\u001b[0m \u001b[0mres\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;32m~\\AppData\\Local\\Temp/ipykernel_11676/455125397.py\u001b[0m in \u001b[0;36mtransform\u001b[1;34m(self, X)\u001b[0m\n\u001b[0;32m      5\u001b[0m     \u001b[1;32mdef\u001b[0m \u001b[0mtransform\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mself\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mX\u001b[0m\u001b[1;33m:\u001b[0m\u001b[0mpd\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mDataFrame\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      6\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m----> 7\u001b[1;33m         \u001b[0mcheck_is_fitted\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mself\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m      8\u001b[0m         \u001b[0mX\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mself\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0m_check_input\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mX\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0min_fit\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;32mFalse\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mcheck_positive\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;32mTrue\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mcheck_shape\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;32mTrue\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      9\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;31mNameError\u001b[0m: name 'check_is_fitted' is not defined"
     ]
    }
   ],
   "source": [
    "from sklearn.preprocessing import PowerTransformer as _PowerTransformer\n",
    "from sklearn.base import TransformerMixin\n",
    "\n",
    "class PowerTransformer(_PowerTransformer, TransformerMixin):\n",
    "    def transform(self, X:pd.DataFrame):\n",
    "        \n",
    "        check_is_fitted(self)\n",
    "        X = self._check_input(X, in_fit=False, check_positive=True, check_shape=True)\n",
    "\n",
    "        transform_function = {\n",
    "            \"box-cox\": boxcox,\n",
    "            \"yeo-johnson\": self._yeo_johnson_transform,\n",
    "        }[self.method]\n",
    "        for i, lmbda in enumerate(self.lambdas_):\n",
    "            with np.errstate(invalid=\"ignore\"):  # hide NaN warnings\n",
    "                X[:, i] = transform_function(X[:, i], lmbda)\n",
    "\n",
    "        if self.standardize:\n",
    "            X = self._scaler.transform(X)\n",
    "\n",
    "        X_df = pd.DataFrame(X, columns=X.columns, index=X.index)\n",
    "        \n",
    "        return Xt_df\n",
    "    \n",
    "ss = PowerTransformer()\n",
    "\n",
    "res = ss.transform(trn_df)\n",
    "\n",
    "res"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.preprocessing import PowerTransformer\n",
    "\n",
    "class PowerTransformerDF(PowerTransformer):\n",
    "\n",
    "    def transform(self, X: pd.DataFrame):\n",
    "        \n",
    "        print('child')\n",
    "        \n",
    "        # call the parent transform\n",
    "        Xt_arr = super(PowerTransformerDF, self).transform(X)\n",
    "\n",
    "        # put the array back into a Pandas DataFrame\n",
    "        Xt_df = pd.DataFrame(Xt_arr, columns=X.columns, index=X.index)\n",
    "        \n",
    "        print('made it')\n",
    "\n",
    "        return Xt_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "D:\\Anaconda3\\envs\\geosaurus\\lib\\site-packages\\sklearn\\preprocessing\\_data.py:3253: RuntimeWarning: divide by zero encountered in log\n",
      "  loglike = -n_samples / 2 * np.log(x_trans.var())\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "array([[ 0.16855042, -1.11350457, -0.54217628,  0.11286603,  1.15896583,\n",
       "         0.24090778, -0.18358702,  0.        , -0.04677022,  0.18431223,\n",
       "        -0.06240979, -0.60302857,  0.06434243, -0.46008614,  0.50360584,\n",
       "         0.50700755,  0.5253881 ,  0.07725866,  0.01926198,  0.13649968],\n",
       "       [-1.19606641, -1.11350457, -1.47718988, -1.11876269, -1.77935893,\n",
       "        -1.99284792, -1.68652843,  0.        , -1.06741558, -1.16113791,\n",
       "        -0.96699852, -0.81475061,  0.17348101, -0.33543968, -0.08582943,\n",
       "        -0.06192985, -0.18216615, -1.20874058, -1.22239441, -1.20442689],\n",
       "       [-0.96889112, -0.14835307, -1.06063985, -0.95810529, -0.79336842,\n",
       "        -0.07251376,  1.24661914,  0.        , -1.13045506, -0.95473799,\n",
       "        -0.99126772, -1.43920363,  0.75550625,  0.26417162, -1.5413854 ,\n",
       "        -1.59827938, -1.62841907, -1.02855037, -0.9930183 , -1.0430459 ],\n",
       "       [ 1.04167961,  1.45241314,  0.63891596,  1.13405084, -0.89616209,\n",
       "        -0.40967738,  0.03227582,  0.        ,  1.20157981,  0.93885596,\n",
       "         1.3816789 ,  1.74768757,  0.00460604,  0.66062192,  0.10214702,\n",
       "         0.15172907,  0.12831547,  1.29081606,  1.48052535,  1.01906476],\n",
       "       [ 1.28752499,  1.4550447 ,  0.89981298,  1.30434606,  0.0852949 ,\n",
       "        -0.48731748, -0.75686656,  0.        ,  1.28919827,  1.2477725 ,\n",
       "         1.38156256,  0.43529789, -0.84833784, -0.64266844, -0.02965775,\n",
       "        -0.10048841, -0.27783917,  1.27368264,  1.24055122,  1.31022225],\n",
       "       [-0.75869165, -1.11350457, -1.1244652 , -0.70794344, -1.18246813,\n",
       "         1.97274454,  1.40887954,  0.        , -0.37170729, -0.69953006,\n",
       "        -0.73778795,  0.75380165,  2.30238152,  2.15765872,  1.71792246,\n",
       "         1.7810859 ,  1.75087657, -0.64802936, -0.54585145, -0.69389795],\n",
       "       [ 0.90736454,  1.07070124,  0.50968959,  0.90548763,  0.36673942,\n",
       "         1.08936041,  1.22716918,  0.        ,  0.89461173,  0.99510966,\n",
       "         0.76294388,  0.93229963, -0.04673038,  0.1479401 ,  0.12105982,\n",
       "         0.09319424,  0.10872034,  0.89579674,  0.90410273,  0.91121055],\n",
       "       [-1.78100868, -1.11350457, -1.32892609, -1.81165784, -0.57611362,\n",
       "        -0.21319941,  0.91526347,  0.        , -1.88358275, -1.79725455,\n",
       "        -1.86327952, -1.86965694,  0.76789664,  0.29260423, -0.63675688,\n",
       "        -0.70489424, -0.52348584, -1.77330394, -1.7546355 , -1.78455596],\n",
       "       [ 1.50300697,  1.0684284 ,  0.86749917,  1.46342671,  1.21656466,\n",
       "        -0.30093019, -0.98086461,  0.        ,  1.50138896,  1.52872261,\n",
       "         1.35681949,  1.00653741, -0.86460664, -0.51365565,  1.53447765,\n",
       "         1.36191199,  1.36878954,  1.38143878,  1.26112063,  1.49468379],\n",
       "       [ 0.65840462, -0.26494445,  0.29886151,  0.60804928,  1.21656466,\n",
       "         1.16428484,  0.43407234,  0.        ,  0.54968561,  0.66846376,\n",
       "         0.52374693,  0.45347846, -0.18485228, -0.08107399,  0.75653102,\n",
       "         0.93004728,  0.99379798,  0.55673424,  0.45644338,  0.65367903],\n",
       "       [ 0.03832337,  0.90446599,  0.24369469,  0.07976468, -0.68672141,\n",
       "        -1.37857332, -1.51323234,  0.        , -0.03921687,  0.06583853,\n",
       "         0.16457833, -0.27228891, -2.20987326, -2.24539451, -1.74017053,\n",
       "        -1.68388975, -1.69559717,  0.12452364,  0.28236108,  0.02988145],\n",
       "       [-0.14239615, -0.42286394,  0.07908875, -0.19128744,  0.88018746,\n",
       "         0.27845388, -0.39927173,  0.        , -0.33065055, -0.15222551,\n",
       "        -0.28875953, -0.59920057, -0.19512706, -0.45783549,  0.27310447,\n",
       "         0.24972202,  0.305789  , -0.20395689, -0.36541249, -0.11050751],\n",
       "       [-0.75780051, -0.66087372,  1.99583464, -0.82023454,  0.98987568,\n",
       "         0.10930802,  0.2560712 ,  0.        , -0.56666606, -0.86418923,\n",
       "        -0.66082709,  0.26902662,  0.28131358,  1.21315731, -0.9750483 ,\n",
       "        -0.92521641, -0.8741696 , -0.73766963, -0.76305423, -0.7188073 ]])"
      ]
     },
     "execution_count": 37,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pt = PowerTransformerDF(method='yeo-johnson', )\n",
    "\n",
    "res = pt.fit_transform(trn_df)\n",
    "\n",
    "res"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "True"
      ]
     },
     "execution_count": 51,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "res.shape == trn_df.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(13, 20)"
      ]
     },
     "execution_count": 50,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Standard Geography From a Data Frame"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "For the sake of efficiency, it is possible to provide the dataframe directly as input to the `enrich` method, and use the `standard_geography_id_column` parameter to specify the column. Also, in the following example, we are going to use a local source (ArcGIS Pro with Business Analyst and the USA data pack) and consolidate the steps above.\n",
    "\n",
    "Previously, we loaded a dataframe from memory to use for enrichment consisting of all the block groups in Portland, OR. The values we will be using are located in the `ID` column."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>ID</th>\n",
       "      <th>NAME</th>\n",
       "      <th>IDField</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>160550001001</td>\n",
       "      <td>160550001.001</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>160550003011</td>\n",
       "      <td>160550003.011</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>160550003012</td>\n",
       "      <td>160550003.012</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>160550003021</td>\n",
       "      <td>160550003.021</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>160550004011</td>\n",
       "      <td>160550004.011</td>\n",
       "      <td>17660</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "             ID           NAME IDField\n",
       "0  160550001001  160550001.001   17660\n",
       "1  160550003011  160550003.011   17660\n",
       "2  160550003012  160550003.012   17660\n",
       "3  160550003021  160550003.021   17660\n",
       "4  160550004011  160550004.011   17660"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "block_groups_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next, we create a `Country` object instance using the `'pro'` keyword to indicate using the local ArcGIS Pro instance."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<Country - United States 2021 ('local')>"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "usa_local = Country('usa', gis=GIS('pro'))\n",
    "\n",
    "usa_local"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Just as before, we can filter to just the key current year variables. Although in this case they are identical, since there are small variations in available variables between local and ArcGIS Online, I always apply the filter on variables from the same soure as I will be using for enricment."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>name</th>\n",
       "      <th>alias</th>\n",
       "      <th>data_collection</th>\n",
       "      <th>enrich_name</th>\n",
       "      <th>enrich_field_name</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>TOTPOP_CY</td>\n",
       "      <td>2021 Total Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.TOTPOP_CY</td>\n",
       "      <td>KeyUSFacts_TOTPOP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>GQPOP_CY</td>\n",
       "      <td>2021 Group Quarters Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.GQPOP_CY</td>\n",
       "      <td>KeyUSFacts_GQPOP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>DIVINDX_CY</td>\n",
       "      <td>2021 Diversity Index</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DIVINDX_CY</td>\n",
       "      <td>KeyUSFacts_DIVINDX_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>TOTHH_CY</td>\n",
       "      <td>2021 Total Households</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.TOTHH_CY</td>\n",
       "      <td>KeyUSFacts_TOTHH_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>AVGHHSZ_CY</td>\n",
       "      <td>2021 Average Household Size</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.AVGHHSZ_CY</td>\n",
       "      <td>KeyUSFacts_AVGHHSZ_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>MEDHINC_CY</td>\n",
       "      <td>2021 Median Household Income</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.MEDHINC_CY</td>\n",
       "      <td>KeyUSFacts_MEDHINC_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>AVGHINC_CY</td>\n",
       "      <td>2021 Average Household Income</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.AVGHINC_CY</td>\n",
       "      <td>KeyUSFacts_AVGHINC_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>PCI_CY</td>\n",
       "      <td>2021 Per Capita Income</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.PCI_CY</td>\n",
       "      <td>KeyUSFacts_PCI_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>TOTHU_CY</td>\n",
       "      <td>2021 Total Housing Units</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.TOTHU_CY</td>\n",
       "      <td>KeyUSFacts_TOTHU_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>OWNER_CY</td>\n",
       "      <td>2021 Owner Occupied HUs</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.OWNER_CY</td>\n",
       "      <td>KeyUSFacts_OWNER_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>RENTER_CY</td>\n",
       "      <td>2021 Renter Occupied HUs</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.RENTER_CY</td>\n",
       "      <td>KeyUSFacts_RENTER_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>VACANT_CY</td>\n",
       "      <td>2021 Vacant Housing Units</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.VACANT_CY</td>\n",
       "      <td>KeyUSFacts_VACANT_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>MEDVAL_CY</td>\n",
       "      <td>2021 Median Home Value</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.MEDVAL_CY</td>\n",
       "      <td>KeyUSFacts_MEDVAL_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>AVGVAL_CY</td>\n",
       "      <td>2021 Average Home Value</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.AVGVAL_CY</td>\n",
       "      <td>KeyUSFacts_AVGVAL_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>POPGRW10CY</td>\n",
       "      <td>2010-2021 Growth Rate: Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.POPGRW10CY</td>\n",
       "      <td>KeyUSFacts_POPGRW10CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>HHGRW10CY</td>\n",
       "      <td>2010-2021 Growth Rate: Households</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.HHGRW10CY</td>\n",
       "      <td>KeyUSFacts_HHGRW10CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>FAMGRW10CY</td>\n",
       "      <td>2010-2021 Growth Rate: Families</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.FAMGRW10CY</td>\n",
       "      <td>KeyUSFacts_FAMGRW10CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>DPOP_CY</td>\n",
       "      <td>2021 Total Daytime Population</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DPOP_CY</td>\n",
       "      <td>KeyUSFacts_DPOP_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>DPOPWRK_CY</td>\n",
       "      <td>2021 Daytime Pop: Workers</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DPOPWRK_CY</td>\n",
       "      <td>KeyUSFacts_DPOPWRK_CY</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>DPOPRES_CY</td>\n",
       "      <td>2021 Daytime Pop: Residents</td>\n",
       "      <td>KeyUSFacts</td>\n",
       "      <td>KeyUSFacts.DPOPRES_CY</td>\n",
       "      <td>KeyUSFacts_DPOPRES_CY</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          name                              alias data_collection  \\\n",
       "0    TOTPOP_CY              2021 Total Population      KeyUSFacts   \n",
       "1     GQPOP_CY     2021 Group Quarters Population      KeyUSFacts   \n",
       "2   DIVINDX_CY               2021 Diversity Index      KeyUSFacts   \n",
       "3     TOTHH_CY              2021 Total Households      KeyUSFacts   \n",
       "4   AVGHHSZ_CY        2021 Average Household Size      KeyUSFacts   \n",
       "5   MEDHINC_CY       2021 Median Household Income      KeyUSFacts   \n",
       "6   AVGHINC_CY      2021 Average Household Income      KeyUSFacts   \n",
       "7       PCI_CY             2021 Per Capita Income      KeyUSFacts   \n",
       "8     TOTHU_CY           2021 Total Housing Units      KeyUSFacts   \n",
       "9     OWNER_CY            2021 Owner Occupied HUs      KeyUSFacts   \n",
       "10   RENTER_CY           2021 Renter Occupied HUs      KeyUSFacts   \n",
       "11   VACANT_CY          2021 Vacant Housing Units      KeyUSFacts   \n",
       "12   MEDVAL_CY             2021 Median Home Value      KeyUSFacts   \n",
       "13   AVGVAL_CY            2021 Average Home Value      KeyUSFacts   \n",
       "14  POPGRW10CY  2010-2021 Growth Rate: Population      KeyUSFacts   \n",
       "15   HHGRW10CY  2010-2021 Growth Rate: Households      KeyUSFacts   \n",
       "16  FAMGRW10CY    2010-2021 Growth Rate: Families      KeyUSFacts   \n",
       "17     DPOP_CY      2021 Total Daytime Population      KeyUSFacts   \n",
       "18  DPOPWRK_CY          2021 Daytime Pop: Workers      KeyUSFacts   \n",
       "19  DPOPRES_CY        2021 Daytime Pop: Residents      KeyUSFacts   \n",
       "\n",
       "              enrich_name      enrich_field_name  \n",
       "0    KeyUSFacts.TOTPOP_CY   KeyUSFacts_TOTPOP_CY  \n",
       "1     KeyUSFacts.GQPOP_CY    KeyUSFacts_GQPOP_CY  \n",
       "2   KeyUSFacts.DIVINDX_CY  KeyUSFacts_DIVINDX_CY  \n",
       "3     KeyUSFacts.TOTHH_CY    KeyUSFacts_TOTHH_CY  \n",
       "4   KeyUSFacts.AVGHHSZ_CY  KeyUSFacts_AVGHHSZ_CY  \n",
       "5   KeyUSFacts.MEDHINC_CY  KeyUSFacts_MEDHINC_CY  \n",
       "6   KeyUSFacts.AVGHINC_CY  KeyUSFacts_AVGHINC_CY  \n",
       "7       KeyUSFacts.PCI_CY      KeyUSFacts_PCI_CY  \n",
       "8     KeyUSFacts.TOTHU_CY    KeyUSFacts_TOTHU_CY  \n",
       "9     KeyUSFacts.OWNER_CY    KeyUSFacts_OWNER_CY  \n",
       "10   KeyUSFacts.RENTER_CY   KeyUSFacts_RENTER_CY  \n",
       "11   KeyUSFacts.VACANT_CY   KeyUSFacts_VACANT_CY  \n",
       "12   KeyUSFacts.MEDVAL_CY   KeyUSFacts_MEDVAL_CY  \n",
       "13   KeyUSFacts.AVGVAL_CY   KeyUSFacts_AVGVAL_CY  \n",
       "14  KeyUSFacts.POPGRW10CY  KeyUSFacts_POPGRW10CY  \n",
       "15   KeyUSFacts.HHGRW10CY   KeyUSFacts_HHGRW10CY  \n",
       "16  KeyUSFacts.FAMGRW10CY  KeyUSFacts_FAMGRW10CY  \n",
       "17     KeyUSFacts.DPOP_CY     KeyUSFacts_DPOP_CY  \n",
       "18  KeyUSFacts.DPOPWRK_CY  KeyUSFacts_DPOPWRK_CY  \n",
       "19  KeyUSFacts.DPOPRES_CY  KeyUSFacts_DPOPRES_CY  "
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ev = usa_local.enrich_variables\n",
    "kv = ev[\n",
    "    (ev.data_collection.str.lower().str.contains('key'))\n",
    "    & (ev.name.str.lower().str.endswith('cy'))\n",
    "].reset_index(drop=True)\n",
    "\n",
    "kv"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Just double checking, we can quickly see the correct value we need to use for United States Census Block Groups is `block_groups`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>level_name</th>\n",
       "      <th>alias</th>\n",
       "      <th>level_id</th>\n",
       "      <th>id_field</th>\n",
       "      <th>name_field</th>\n",
       "      <th>singular_name</th>\n",
       "      <th>plural_name</th>\n",
       "      <th>admin_level</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>block_groups</td>\n",
       "      <td>Block Groups</td>\n",
       "      <td>US.BlockGroups</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>Block Group</td>\n",
       "      <td>Block Groups</td>\n",
       "      <td>Admin11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>tracts</td>\n",
       "      <td>Census Tracts</td>\n",
       "      <td>US.Tracts</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>Census Tract</td>\n",
       "      <td>Census Tracts</td>\n",
       "      <td>Admin10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>places</td>\n",
       "      <td>Cities and Towns (Places)</td>\n",
       "      <td>US.Places</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>Place</td>\n",
       "      <td>Places</td>\n",
       "      <td>Admin9</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>zip5</td>\n",
       "      <td>ZIP Codes</td>\n",
       "      <td>US.ZIP5</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>ZIP Code</td>\n",
       "      <td>ZIP Codes</td>\n",
       "      <td>Admin4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>csd</td>\n",
       "      <td>County Subdivisions</td>\n",
       "      <td>US.CSD</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>County Subdivision</td>\n",
       "      <td>County Subdivisions</td>\n",
       "      <td>Admin7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>counties</td>\n",
       "      <td>Counties</td>\n",
       "      <td>US.Counties</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>County</td>\n",
       "      <td>Counties</td>\n",
       "      <td>Admin3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>cbsa</td>\n",
       "      <td>CBSAs</td>\n",
       "      <td>US.CBSA</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>CBSA</td>\n",
       "      <td>CBSAs</td>\n",
       "      <td>Admin5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>cd</td>\n",
       "      <td>Congressional Districts</td>\n",
       "      <td>US.CD</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>Congressional District</td>\n",
       "      <td>Congressional Districts</td>\n",
       "      <td>Admin8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>dma</td>\n",
       "      <td>DMAs</td>\n",
       "      <td>US.DMA</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>DMA</td>\n",
       "      <td>DMAs</td>\n",
       "      <td>Admin6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>states</td>\n",
       "      <td>States</td>\n",
       "      <td>US.States</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>State</td>\n",
       "      <td>States</td>\n",
       "      <td>Admin2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>whole_usa</td>\n",
       "      <td>Entire Country</td>\n",
       "      <td>US.WholeUSA</td>\n",
       "      <td>ID</td>\n",
       "      <td>NAME</td>\n",
       "      <td>United States of America</td>\n",
       "      <td>United States of America</td>\n",
       "      <td>Admin1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      level_name                      alias        level_id id_field  \\\n",
       "0   block_groups               Block Groups  US.BlockGroups       ID   \n",
       "1         tracts              Census Tracts       US.Tracts       ID   \n",
       "2         places  Cities and Towns (Places)       US.Places       ID   \n",
       "3           zip5                  ZIP Codes         US.ZIP5       ID   \n",
       "4            csd        County Subdivisions          US.CSD       ID   \n",
       "5       counties                   Counties     US.Counties       ID   \n",
       "6           cbsa                      CBSAs         US.CBSA       ID   \n",
       "7             cd    Congressional Districts           US.CD       ID   \n",
       "8            dma                       DMAs          US.DMA       ID   \n",
       "9         states                     States       US.States       ID   \n",
       "10     whole_usa             Entire Country     US.WholeUSA       ID   \n",
       "\n",
       "   name_field             singular_name               plural_name admin_level  \n",
       "0        NAME               Block Group              Block Groups     Admin11  \n",
       "1        NAME              Census Tract             Census Tracts     Admin10  \n",
       "2        NAME                     Place                    Places      Admin9  \n",
       "3        NAME                  ZIP Code                 ZIP Codes      Admin4  \n",
       "4        NAME        County Subdivision       County Subdivisions      Admin7  \n",
       "5        NAME                    County                  Counties      Admin3  \n",
       "6        NAME                      CBSA                     CBSAs      Admin5  \n",
       "7        NAME    Congressional District   Congressional Districts      Admin8  \n",
       "8        NAME                       DMA                      DMAs      Admin6  \n",
       "9        NAME                     State                    States      Admin2  \n",
       "10       NAME  United States of America  United States of America      Admin1  "
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "usa_local.levels"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now, we are ready to enrich using ArcGIS Pro with Business Analyst and the USA data pack."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "bg_enrich_df = usa_local.enrich(block_groups_df, enrich_variables=kv, standard_geography_level='block_groups', standard_geography_id_column='ID')\n",
    "\n",
    "bg_enrich_df.info()\n",
    "bg_enrich_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Consolidating into a Function"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "All of the above steps, if consolidated into a succicent function only containing the logic necessary to run, can look like the following. Also, although some of the imports below are redundant, I include everything needed in this cell soy you can easily copy this and modify it to suit your needs."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [],
   "source": [
    "from typing import Iterable, Optional, Union\n",
    "\n",
    "from arcgis.gis import GIS\n",
    "from arcgis.geoenrichment import Country\n",
    "import pandas as pd\n",
    "\n",
    "def enrich_std_geo(\n",
    "    country: Country, \n",
    "    geographies: Iterable, \n",
    "    std_geo_lvl: str, \n",
    "    enrich_vars: Optional[Iterable] = None, \n",
    "    std_geo_col: Optional[str] = None\n",
    ") -> pd.DataFrame:\n",
    "    \n",
    "    # if no enrich variables provided, get the current year key variables\n",
    "    if enrich_vars is None:\n",
    "        enrich_vars = country.enrich_variables[\n",
    "            (country.enrich_variables.data_collection.str.lower().str.contains('key'))\n",
    "            & (country.enrich_variables.name.str.lower().str.endswith('cy'))\n",
    "        ].reset_index(drop=True)\n",
    "        \n",
    "    # invoke enrich method against standard geographies\n",
    "    enrich_df = country.enrich(geographies, \n",
    "                               enrich_variables=enrich_vars, \n",
    "                               standard_geography_level=std_geo_lvl, \n",
    "                               standard_geography_id_column=std_geo_col)\n",
    "    \n",
    "    return enrich_df"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Switching Sources\n",
    "\n",
    "Using the above function we can easily accomplish all the steps detailed above in one succicent step. Based on this, we can quickly switch between sources by swapping out the `Country` instance. As is evident below, switching sources requires little more than changing the country object. Everything else works the same, and _this is the point_. This API is designed to enable you to easily work with Business Analyst data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 13 entries, 0 to 12\n",
      "Data columns (total 27 columns):\n",
      " #   Column                 Non-Null Count  Dtype   \n",
      "---  ------                 --------------  -----   \n",
      " 0   id_field               13 non-null     object  \n",
      " 1   area_desc              13 non-null     object  \n",
      " 2   ta_desc                13 non-null     object  \n",
      " 3   names                  13 non-null     object  \n",
      " 4   has_data               13 non-null     int64   \n",
      " 5   aggregation_method     13 non-null     object  \n",
      " 6   keyusfacts_totpop_cy   13 non-null     float64 \n",
      " 7   keyusfacts_gqpop_cy    13 non-null     float64 \n",
      " 8   keyusfacts_divindx_cy  13 non-null     float64 \n",
      " 9   keyusfacts_tothh_cy    13 non-null     float64 \n",
      " 10  keyusfacts_avghhsz_cy  13 non-null     float64 \n",
      " 11  keyusfacts_medhinc_cy  13 non-null     float64 \n",
      " 12  keyusfacts_avghinc_cy  13 non-null     float64 \n",
      " 13  keyusfacts_pci_cy      13 non-null     float64 \n",
      " 14  keyusfacts_tothu_cy    13 non-null     float64 \n",
      " 15  keyusfacts_owner_cy    13 non-null     float64 \n",
      " 16  keyusfacts_renter_cy   13 non-null     float64 \n",
      " 17  keyusfacts_vacant_cy   13 non-null     float64 \n",
      " 18  keyusfacts_medval_cy   13 non-null     float64 \n",
      " 19  keyusfacts_avgval_cy   13 non-null     float64 \n",
      " 20  keyusfacts_popgrw10cy  13 non-null     float64 \n",
      " 21  keyusfacts_hhgrw10cy   13 non-null     float64 \n",
      " 22  keyusfacts_famgrw10cy  13 non-null     float64 \n",
      " 23  keyusfacts_dpop_cy     13 non-null     float64 \n",
      " 24  keyusfacts_dpopwrk_cy  13 non-null     float64 \n",
      " 25  keyusfacts_dpopres_cy  13 non-null     float64 \n",
      " 26  SHAPE                  13 non-null     geometry\n",
      "dtypes: float64(20), geometry(1), int64(1), object(5)\n",
      "memory usage: 2.9+ KB\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id_field</th>\n",
       "      <th>area_desc</th>\n",
       "      <th>ta_desc</th>\n",
       "      <th>names</th>\n",
       "      <th>has_data</th>\n",
       "      <th>aggregation_method</th>\n",
       "      <th>keyusfacts_totpop_cy</th>\n",
       "      <th>keyusfacts_gqpop_cy</th>\n",
       "      <th>keyusfacts_divindx_cy</th>\n",
       "      <th>keyusfacts_tothh_cy</th>\n",
       "      <th>...</th>\n",
       "      <th>keyusfacts_vacant_cy</th>\n",
       "      <th>keyusfacts_medval_cy</th>\n",
       "      <th>keyusfacts_avgval_cy</th>\n",
       "      <th>keyusfacts_popgrw10cy</th>\n",
       "      <th>keyusfacts_hhgrw10cy</th>\n",
       "      <th>keyusfacts_famgrw10cy</th>\n",
       "      <th>keyusfacts_dpop_cy</th>\n",
       "      <th>keyusfacts_dpopwrk_cy</th>\n",
       "      <th>keyusfacts_dpopres_cy</th>\n",
       "      <th>SHAPE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>83801</td>\n",
       "      <td>83801</td>\n",
       "      <td>TA from geography Layer: 83801</td>\n",
       "      <td>Athol</td>\n",
       "      <td>1</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>8497.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>13.6</td>\n",
       "      <td>3142.0</td>\n",
       "      <td>...</td>\n",
       "      <td>421.0</td>\n",
       "      <td>382542.0</td>\n",
       "      <td>391184.0</td>\n",
       "      <td>2.07</td>\n",
       "      <td>2.09</td>\n",
       "      <td>1.92</td>\n",
       "      <td>6502.0</td>\n",
       "      <td>1962.0</td>\n",
       "      <td>4540.0</td>\n",
       "      <td>{\"rings\": [[[-116.69531754199994, 48.075561486...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>83803</td>\n",
       "      <td>83803</td>\n",
       "      <td>TA from geography Layer: 83803</td>\n",
       "      <td>Bayview</td>\n",
       "      <td>1</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>656.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>10.5</td>\n",
       "      <td>341.0</td>\n",
       "      <td>...</td>\n",
       "      <td>318.0</td>\n",
       "      <td>391333.0</td>\n",
       "      <td>403113.0</td>\n",
       "      <td>1.76</td>\n",
       "      <td>1.80</td>\n",
       "      <td>1.56</td>\n",
       "      <td>499.0</td>\n",
       "      <td>145.0</td>\n",
       "      <td>354.0</td>\n",
       "      <td>{\"rings\": [[[-116.49664843299996, 47.991467237...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>83810</td>\n",
       "      <td>83810</td>\n",
       "      <td>TA from geography Layer: 83810</td>\n",
       "      <td>Cataldo</td>\n",
       "      <td>1</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>1090.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>11.7</td>\n",
       "      <td>479.0</td>\n",
       "      <td>...</td>\n",
       "      <td>100.0</td>\n",
       "      <td>437903.0</td>\n",
       "      <td>464383.0</td>\n",
       "      <td>0.94</td>\n",
       "      <td>0.96</td>\n",
       "      <td>0.76</td>\n",
       "      <td>762.0</td>\n",
       "      <td>246.0</td>\n",
       "      <td>516.0</td>\n",
       "      <td>{\"rings\": [[[-116.40476999999998, 47.612660000...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>83814</td>\n",
       "      <td>83814</td>\n",
       "      <td>TA from geography Layer: 83814</td>\n",
       "      <td>Coeur D Alene</td>\n",
       "      <td>1</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>28546.0</td>\n",
       "      <td>609.0</td>\n",
       "      <td>21.2</td>\n",
       "      <td>12454.0</td>\n",
       "      <td>...</td>\n",
       "      <td>2600.0</td>\n",
       "      <td>377722.0</td>\n",
       "      <td>508589.0</td>\n",
       "      <td>1.86</td>\n",
       "      <td>1.91</td>\n",
       "      <td>1.72</td>\n",
       "      <td>38178.0</td>\n",
       "      <td>23011.0</td>\n",
       "      <td>15167.0</td>\n",
       "      <td>{\"rings\": [[[-116.58028267699996, 47.744349415...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>83815</td>\n",
       "      <td>83815</td>\n",
       "      <td>TA from geography Layer: 83815</td>\n",
       "      <td>Coeur D Alene</td>\n",
       "      <td>1</td>\n",
       "      <td>BlockApportionment:US.BlockGroups;PointsLayer:...</td>\n",
       "      <td>38614.0</td>\n",
       "      <td>617.0</td>\n",
       "      <td>24.1</td>\n",
       "      <td>15247.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1146.0</td>\n",
       "      <td>308198.0</td>\n",
       "      <td>374194.0</td>\n",
       "      <td>1.79</td>\n",
       "      <td>1.78</td>\n",
       "      <td>1.51</td>\n",
       "      <td>37345.0</td>\n",
       "      <td>15891.0</td>\n",
       "      <td>21454.0</td>\n",
       "      <td>{\"rings\": [[[-116.69478052499994, 47.725640161...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 27 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "  id_field area_desc                         ta_desc          names  has_data  \\\n",
       "0    83801     83801  TA from geography Layer: 83801          Athol         1   \n",
       "1    83803     83803  TA from geography Layer: 83803        Bayview         1   \n",
       "2    83810     83810  TA from geography Layer: 83810        Cataldo         1   \n",
       "3    83814     83814  TA from geography Layer: 83814  Coeur D Alene         1   \n",
       "4    83815     83815  TA from geography Layer: 83815  Coeur D Alene         1   \n",
       "\n",
       "                                  aggregation_method  keyusfacts_totpop_cy  \\\n",
       "0  BlockApportionment:US.BlockGroups;PointsLayer:...                8497.0   \n",
       "1  BlockApportionment:US.BlockGroups;PointsLayer:...                 656.0   \n",
       "2  BlockApportionment:US.BlockGroups;PointsLayer:...                1090.0   \n",
       "3  BlockApportionment:US.BlockGroups;PointsLayer:...               28546.0   \n",
       "4  BlockApportionment:US.BlockGroups;PointsLayer:...               38614.0   \n",
       "\n",
       "   keyusfacts_gqpop_cy  keyusfacts_divindx_cy  keyusfacts_tothh_cy  ...  \\\n",
       "0                  0.0                   13.6               3142.0  ...   \n",
       "1                  0.0                   10.5                341.0  ...   \n",
       "2                  4.0                   11.7                479.0  ...   \n",
       "3                609.0                   21.2              12454.0  ...   \n",
       "4                617.0                   24.1              15247.0  ...   \n",
       "\n",
       "   keyusfacts_vacant_cy  keyusfacts_medval_cy  keyusfacts_avgval_cy  \\\n",
       "0                 421.0              382542.0              391184.0   \n",
       "1                 318.0              391333.0              403113.0   \n",
       "2                 100.0              437903.0              464383.0   \n",
       "3                2600.0              377722.0              508589.0   \n",
       "4                1146.0              308198.0              374194.0   \n",
       "\n",
       "   keyusfacts_popgrw10cy  keyusfacts_hhgrw10cy  keyusfacts_famgrw10cy  \\\n",
       "0                   2.07                  2.09                   1.92   \n",
       "1                   1.76                  1.80                   1.56   \n",
       "2                   0.94                  0.96                   0.76   \n",
       "3                   1.86                  1.91                   1.72   \n",
       "4                   1.79                  1.78                   1.51   \n",
       "\n",
       "   keyusfacts_dpop_cy  keyusfacts_dpopwrk_cy  keyusfacts_dpopres_cy  \\\n",
       "0              6502.0                 1962.0                 4540.0   \n",
       "1               499.0                  145.0                  354.0   \n",
       "2               762.0                  246.0                  516.0   \n",
       "3             38178.0                23011.0                15167.0   \n",
       "4             37345.0                15891.0                21454.0   \n",
       "\n",
       "                                               SHAPE  \n",
       "0  {\"rings\": [[[-116.69531754199994, 48.075561486...  \n",
       "1  {\"rings\": [[[-116.49664843299996, 47.991467237...  \n",
       "2  {\"rings\": [[[-116.40476999999998, 47.612660000...  \n",
       "3  {\"rings\": [[[-116.58028267699996, 47.744349415...  \n",
       "4  {\"rings\": [[[-116.69478052499994, 47.725640161...  \n",
       "\n",
       "[5 rows x 27 columns]"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "local_fn_enrich_df = enrich_std_geo(usa_local, geographies=postal_code_lst, std_geo_lvl='zip5')\n",
    "\n",
    "local_fn_enrich_df.info()\n",
    "local_fn_enrich_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 13 entries, 0 to 12\n",
      "Data columns (total 29 columns):\n",
      " #   Column                             Non-Null Count  Dtype   \n",
      "---  ------                             --------------  -----   \n",
      " 0   std_geography_level                13 non-null     object  \n",
      " 1   std_geography_name                 13 non-null     object  \n",
      " 2   std_geography_id                   13 non-null     object  \n",
      " 3   source_country                     13 non-null     object  \n",
      " 4   aggregation_method                 13 non-null     object  \n",
      " 5   population_to_polygon_size_rating  13 non-null     float64 \n",
      " 6   apportionment_confidence           13 non-null     float64 \n",
      " 7   has_data                           13 non-null     int64   \n",
      " 8   totpop_cy                          13 non-null     int64   \n",
      " 9   gqpop_cy                           13 non-null     int64   \n",
      " 10  divindx_cy                         13 non-null     float64 \n",
      " 11  tothh_cy                           13 non-null     int64   \n",
      " 12  avghhsz_cy                         13 non-null     float64 \n",
      " 13  medhinc_cy                         13 non-null     int64   \n",
      " 14  avghinc_cy                         13 non-null     int64   \n",
      " 15  pci_cy                             13 non-null     int64   \n",
      " 16  tothu_cy                           13 non-null     int64   \n",
      " 17  owner_cy                           13 non-null     int64   \n",
      " 18  renter_cy                          13 non-null     int64   \n",
      " 19  vacant_cy                          13 non-null     int64   \n",
      " 20  medval_cy                          13 non-null     int64   \n",
      " 21  avgval_cy                          13 non-null     int64   \n",
      " 22  popgrw10_cy                        13 non-null     float64 \n",
      " 23  hhgrw10_cy                         13 non-null     float64 \n",
      " 24  famgrw10_cy                        13 non-null     float64 \n",
      " 25  dpop_cy                            13 non-null     int64   \n",
      " 26  dpopwrk_cy                         13 non-null     int64   \n",
      " 27  dpopres_cy                         13 non-null     int64   \n",
      " 28  SHAPE                              13 non-null     geometry\n",
      "dtypes: float64(7), geometry(1), int64(16), object(5)\n",
      "memory usage: 3.1+ KB\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>std_geography_level</th>\n",
       "      <th>std_geography_name</th>\n",
       "      <th>std_geography_id</th>\n",
       "      <th>source_country</th>\n",
       "      <th>aggregation_method</th>\n",
       "      <th>population_to_polygon_size_rating</th>\n",
       "      <th>apportionment_confidence</th>\n",
       "      <th>has_data</th>\n",
       "      <th>totpop_cy</th>\n",
       "      <th>gqpop_cy</th>\n",
       "      <th>...</th>\n",
       "      <th>vacant_cy</th>\n",
       "      <th>medval_cy</th>\n",
       "      <th>avgval_cy</th>\n",
       "      <th>popgrw10_cy</th>\n",
       "      <th>hhgrw10_cy</th>\n",
       "      <th>famgrw10_cy</th>\n",
       "      <th>dpop_cy</th>\n",
       "      <th>dpopwrk_cy</th>\n",
       "      <th>dpopres_cy</th>\n",
       "      <th>SHAPE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>US.ZIP5</td>\n",
       "      <td>Athol</td>\n",
       "      <td>83801</td>\n",
       "      <td>US</td>\n",
       "      <td>Query:US.ZIP5</td>\n",
       "      <td>2.191</td>\n",
       "      <td>2.576</td>\n",
       "      <td>1</td>\n",
       "      <td>8497</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>421</td>\n",
       "      <td>382542</td>\n",
       "      <td>391184</td>\n",
       "      <td>2.07</td>\n",
       "      <td>2.09</td>\n",
       "      <td>1.92</td>\n",
       "      <td>6502</td>\n",
       "      <td>1962</td>\n",
       "      <td>4540</td>\n",
       "      <td>{\"rings\": [[[-116.69531754168734, 48.075561485...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>US.ZIP5</td>\n",
       "      <td>Bayview</td>\n",
       "      <td>83803</td>\n",
       "      <td>US</td>\n",
       "      <td>Query:US.ZIP5</td>\n",
       "      <td>2.191</td>\n",
       "      <td>2.576</td>\n",
       "      <td>1</td>\n",
       "      <td>656</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>318</td>\n",
       "      <td>391333</td>\n",
       "      <td>403113</td>\n",
       "      <td>1.76</td>\n",
       "      <td>1.80</td>\n",
       "      <td>1.56</td>\n",
       "      <td>499</td>\n",
       "      <td>145</td>\n",
       "      <td>354</td>\n",
       "      <td>{\"rings\": [[[-116.49664843313857, 47.991467236...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>US.ZIP5</td>\n",
       "      <td>Cataldo</td>\n",
       "      <td>83810</td>\n",
       "      <td>US</td>\n",
       "      <td>Query:US.ZIP5</td>\n",
       "      <td>2.191</td>\n",
       "      <td>2.576</td>\n",
       "      <td>1</td>\n",
       "      <td>1090</td>\n",
       "      <td>4</td>\n",
       "      <td>...</td>\n",
       "      <td>100</td>\n",
       "      <td>439516</td>\n",
       "      <td>465172</td>\n",
       "      <td>0.94</td>\n",
       "      <td>0.96</td>\n",
       "      <td>0.76</td>\n",
       "      <td>762</td>\n",
       "      <td>246</td>\n",
       "      <td>516</td>\n",
       "      <td>{\"rings\": [[[-116.40476999992698, 47.612659999...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>US.ZIP5</td>\n",
       "      <td>Coeur D Alene</td>\n",
       "      <td>83814</td>\n",
       "      <td>US</td>\n",
       "      <td>Query:US.ZIP5</td>\n",
       "      <td>2.191</td>\n",
       "      <td>2.576</td>\n",
       "      <td>1</td>\n",
       "      <td>28546</td>\n",
       "      <td>609</td>\n",
       "      <td>...</td>\n",
       "      <td>2600</td>\n",
       "      <td>377722</td>\n",
       "      <td>508589</td>\n",
       "      <td>1.86</td>\n",
       "      <td>1.91</td>\n",
       "      <td>1.72</td>\n",
       "      <td>38109</td>\n",
       "      <td>22942</td>\n",
       "      <td>15167</td>\n",
       "      <td>{\"rings\": [[[-116.58028267664488, 47.744349414...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>US.ZIP5</td>\n",
       "      <td>Coeur D Alene</td>\n",
       "      <td>83815</td>\n",
       "      <td>US</td>\n",
       "      <td>Query:US.ZIP5</td>\n",
       "      <td>2.191</td>\n",
       "      <td>2.576</td>\n",
       "      <td>1</td>\n",
       "      <td>38614</td>\n",
       "      <td>617</td>\n",
       "      <td>...</td>\n",
       "      <td>1146</td>\n",
       "      <td>308198</td>\n",
       "      <td>374194</td>\n",
       "      <td>1.79</td>\n",
       "      <td>1.78</td>\n",
       "      <td>1.51</td>\n",
       "      <td>37345</td>\n",
       "      <td>15891</td>\n",
       "      <td>21454</td>\n",
       "      <td>{\"rings\": [[[-116.69790643782714, 47.729762324...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 29 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "  std_geography_level std_geography_name std_geography_id source_country  \\\n",
       "0             US.ZIP5              Athol            83801             US   \n",
       "1             US.ZIP5            Bayview            83803             US   \n",
       "2             US.ZIP5            Cataldo            83810             US   \n",
       "3             US.ZIP5      Coeur D Alene            83814             US   \n",
       "4             US.ZIP5      Coeur D Alene            83815             US   \n",
       "\n",
       "  aggregation_method  population_to_polygon_size_rating  \\\n",
       "0      Query:US.ZIP5                              2.191   \n",
       "1      Query:US.ZIP5                              2.191   \n",
       "2      Query:US.ZIP5                              2.191   \n",
       "3      Query:US.ZIP5                              2.191   \n",
       "4      Query:US.ZIP5                              2.191   \n",
       "\n",
       "   apportionment_confidence  has_data  totpop_cy  gqpop_cy  ...  vacant_cy  \\\n",
       "0                     2.576         1       8497         0  ...        421   \n",
       "1                     2.576         1        656         0  ...        318   \n",
       "2                     2.576         1       1090         4  ...        100   \n",
       "3                     2.576         1      28546       609  ...       2600   \n",
       "4                     2.576         1      38614       617  ...       1146   \n",
       "\n",
       "   medval_cy  avgval_cy  popgrw10_cy  hhgrw10_cy  famgrw10_cy  dpop_cy  \\\n",
       "0     382542     391184         2.07        2.09         1.92     6502   \n",
       "1     391333     403113         1.76        1.80         1.56      499   \n",
       "2     439516     465172         0.94        0.96         0.76      762   \n",
       "3     377722     508589         1.86        1.91         1.72    38109   \n",
       "4     308198     374194         1.79        1.78         1.51    37345   \n",
       "\n",
       "   dpopwrk_cy  dpopres_cy                                              SHAPE  \n",
       "0        1962        4540  {\"rings\": [[[-116.69531754168734, 48.075561485...  \n",
       "1         145         354  {\"rings\": [[[-116.49664843313857, 47.991467236...  \n",
       "2         246         516  {\"rings\": [[[-116.40476999992698, 47.612659999...  \n",
       "3       22942       15167  {\"rings\": [[[-116.58028267664488, 47.744349414...  \n",
       "4       15891       21454  {\"rings\": [[[-116.69790643782714, 47.729762324...  \n",
       "\n",
       "[5 rows x 29 columns]"
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "agol_fn_enrich_df = enrich_std_geo(usa_agol, geographies=postal_code_lst, std_geo_lvl='zip5')\n",
    "\n",
    "agol_fn_enrich_df.info()\n",
    "agol_fn_enrich_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.11"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
